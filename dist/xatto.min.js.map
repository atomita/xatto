{"version":3,"sources":["dist/xatto.js"],"names":["global","factory","exports","module","define","amd","xatto","this","CONTEXT","EXTRA","FILL","PATH","SLICE","TEXT","MIDDLEWARES","CHILDREN","KEY","NAME","PROPS","NODE","LIFECYCLE","PREV_PROPS","PREV","assign","target","source","key","hasOwnProperty","CREATE","DESTROY","REMOVE","UPDATE","FUNCTION","OBJECT","STRING","deepSet","value","separator","idx","indexOf","current","slice","nexts","next","split","parseInt","createGlueNode","vNode","recursion","newGlueNode","i","map","child","NowaitState","TEXT_NODE","createVNode","mayBeTextNode","name","props","children","node","noop","deepGet","mutateProvider","getContext","setContext","scheduleRender","context","path","mutate","Promise","then","newContext","_context","_path","targetContext","createNowait","values","subscriptions","subscribeds","mayBeAsync","defaultValue","fulfilled","promise","has","set","pending","catch","err","rejected","get","nowaitPromise","subscribe","isObservable","observable","add","acquired","delete","nowaitObservable","Error","remodelProps","extra","__assign","Object","t","s","n","arguments","length","p","prototype","call","apply","shouldBeCaptureLifecycles","glueNodeMerger","removedNodes","captureLifecycle","glueNode","lifecycle_1","rawLifecycle","shouldBeCaptureLifecycle","shouldBeCaptureLifecycleByCaptured","lifecycle","resolveLifecycle","indexedPrevChildren","prevChild","_prevChild","splice","unshift","index","push","updateAttribute","element","oldValue","isSVG","eventProxy","eventName","Function","addEventListener","removeEventListener","removeAttribute","setAttribute","fireLifeCycleEventProvider","elm","type","detail","events","CustomEvent","event","dispatchEvent","patcher","lifecycleEvents","eventTargetProps","_a","lifecycleEvent","document","createTextNode","createElementNS","createElement","name_1","createNode","prevProps","updated","nodeValue","updateNode","parent_1","parentElement","parentNode","removeChild","done","resolve","reduce","acc","childNode","patchedChild","concat","v","reduceRight","ref","nextSibling","insertBefore","nameTypes","isVNode","x","rest","_i","pop","Array","isArray","resolveChildren","_","childs","resolverProvider","rawProps","parentProps","parentPath","sliced","fill","nodes","proceeded","resolved","resolver","rendererProvider","WeakMap","currentTarget","dispatch","dtl","bubbles","cancelable","eventProxyProvider","glueNodeMergerProvider","patcherProvider","wrapOnion","stack","ContextInner","ExtraInner","atto","view","containerOrGlueNode","options","scheduled","renderNow","rerender","Element","nodeName","createGlueNodeByElement","rootContext","middlewares","Map","Set","forEach","subscription","unsubscribe","clear","createNowaitUnsubscribe","nowaitProvider","nowait","nowaitUnsubscribe","rendererProviders","provider","def","render","renderers","args","finallyer","vNodes","xa","container","rendering","rendered","renderedError","e","Context","currentOnly","eventHandler","Extra"],"mappings":"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","sourcesContent":["/*\nxatto v1.4.3\nhttps://github.com/atomita/xatto\nReleased under the MIT License.\n*/\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (factory((global.xatto = {})));\n}(this, (function (exports) { 'use strict';\n\n  var CONTEXT = 'xa.context';\r\n  var EXTRA = 'xa.extra';\r\n  var FILL = 'xa.fill';\r\n  var PATH = 'xa.path';\r\n  var SLICE = 'xa.slice';\r\n  var TEXT = 'xa.text';\n\n  var MIDDLEWARES = 'middlewares';\n\n  var CHILDREN = 'children';\r\n  var KEY = 'key';\r\n  var NAME = 'name';\r\n  var PROPS = 'props';\n\n  var NODE = 'node';\r\n  var LIFECYCLE = 'lifecycle';\r\n  var PREV = 'prev';\r\n  var PREV_PROPS = PREV + \".\" + PROPS;\n\n  function assign(target, source) {\r\n      for (var key in source) {\r\n          if (source.hasOwnProperty(key)) {\r\n              target[key] = source[key];\r\n          }\r\n      }\r\n      return target;\r\n  }\n\n  var CREATE = 'create';\r\n  var DESTROY = 'destroy';\r\n  var REMOVE = 'remove';\r\n  var UPDATE = 'update';\n\n  var FUNCTION = 'function';\r\n  var OBJECT = 'object';\r\n  var STRING = 'string';\n\n  /**\r\n   * Set an object item to a given value using separator notation.\r\n   *\r\n   * @param  target any\r\n   * @param  key strig\r\n   * @param  value any\r\n   * @param  separator string\r\n   * @return Boolean\r\n   */\r\n  function deepSet(target, key, value, separator) {\r\n      if (separator === void 0) { separator = '.'; }\r\n      while (true) {\r\n          if (OBJECT !== typeof target) {\r\n              return false;\r\n          }\r\n          var idx = key.indexOf(separator);\r\n          if (idx < 0) {\r\n              target[key] = value;\r\n              return true;\r\n          }\r\n          var current = key.slice(0, idx);\r\n          var nexts = key.slice(idx + 1);\r\n          if (null == target[current]) {\r\n              var next = nexts.split(separator, 1)[0];\r\n              target[current] = next === \"\" + parseInt(next, 10) ? [] : {};\r\n          }\r\n          target = target[current];\r\n          key = nexts;\r\n      }\r\n  }\n\n  function createGlueNode(vNode, next, recursion) {\r\n      var newGlueNode = assign({}, vNode);\r\n      newGlueNode.i = 0;\r\n      newGlueNode[LIFECYCLE] = CREATE;\r\n      newGlueNode[CHILDREN] = vNode[CHILDREN].map(function (child) {\r\n          return recursion(CREATE, child);\r\n      });\r\n      deepSet(newGlueNode, PREV_PROPS, {});\r\n      return newGlueNode;\r\n  }\n\n  var TEXT_NODE = 'xa-txt';\n\n  function createVNode(mayBeTextNode, name, props, children) {\r\n      if (props === void 0) { props = {}; }\r\n      if (children === void 0) { children = []; }\r\n      var node = {};\r\n      node[NAME] = name;\r\n      node[PROPS] = props;\r\n      node[CHILDREN] = children;\r\n      node[KEY] = props.key;\r\n      if (mayBeTextNode && FUNCTION !== typeof name) {\r\n          node[NAME] = TEXT_NODE;\r\n          deepSet(node[PROPS], TEXT, name);\r\n      }\r\n      return node;\r\n  }\n\n  function noop() {\r\n      // noop\r\n  }\n\n  function createGlueNodeByElement(element) {\r\n      var glueNode = createGlueNode(createVNode(false, element.nodeName), noop, noop);\r\n      glueNode[NODE] = element;\r\n      return glueNode;\r\n  }\n\n  /**\r\n   * Get an item from an object using separator notation.\r\n   *\r\n   * @typeparam {T}\r\n   * @param {any} target\r\n   * @param {string} key\r\n   * @param {string} separator\r\n   * @return {T}\r\n   */\r\n  function deepGet(target, key, separator) {\r\n      if (separator === void 0) { separator = '.'; }\r\n      while (true) {\r\n          if (target == null) {\r\n              return target;\r\n          }\r\n          var idx = key.indexOf(separator);\r\n          if (idx < 0) {\r\n              return target[key];\r\n          }\r\n          target = target[key.slice(0, idx)];\r\n          key = key.slice(idx + 1);\r\n      }\r\n  }\n\n  function mutate(getContext, setContext, scheduleRender, context, path) {\r\n      if (context) {\r\n          if (context instanceof Promise) {\r\n              return context.then(function (newContext) {\r\n                  return mutate(getContext, setContext, scheduleRender, newContext, path);\r\n              });\r\n          }\r\n          if (FUNCTION === typeof context) {\r\n              return context(function (_context, _path) {\r\n                  if (_path === void 0) { _path = ''; }\r\n                  return mutate(getContext, setContext, scheduleRender, _context, _path);\r\n              }, getContext, path);\r\n          }\r\n          if (OBJECT === typeof context) {\r\n              var targetContext = getContext(path);\r\n              if (context === targetContext) {\r\n                  return;\r\n              }\r\n              var newContext = assign(assign({}, targetContext), context);\r\n              setContext(newContext, path);\r\n              scheduleRender();\r\n          }\r\n      }\r\n  }\n\n  function mutateProvider(getContext, setContext, scheduleRender) {\r\n      return function (context, path) {\r\n          if (path === void 0) { path = ''; }\r\n          return mutate(getContext, setContext, scheduleRender, context, path);\r\n      };\r\n  }\n\n  function isObservable(value) {\r\n      return value.subscribe && FUNCTION == typeof value.subscribe;\r\n  }\n\n  function nowaitPromise(scheduleRender, values, promise, defaultValue) {\r\n      if (defaultValue === void 0) { defaultValue = null; }\r\n      if (!values.has(promise)) {\r\n          values.set(promise, [defaultValue, null, exports.NowaitState.pending]);\r\n          promise\r\n              .then(function (value) {\r\n              values.set(promise, [value, null, exports.NowaitState.fulfilled]);\r\n              scheduleRender();\r\n          })\r\n              .catch(function (err) {\r\n              values.set(promise, [null, err, exports.NowaitState.rejected]);\r\n              scheduleRender();\r\n          });\r\n      }\r\n      return values.get(promise);\r\n  }\r\n  function nowaitObservable(scheduleRender, values, subscriptions, subscribeds, observable, defaultValue) {\r\n      if (defaultValue === void 0) { defaultValue = null; }\r\n      if (!values.has(observable)) {\r\n          values.set(observable, [defaultValue, null, exports.NowaitState.pending]);\r\n      }\r\n      if (!subscriptions.has(observable)) {\r\n          subscriptions.set(observable, observable.subscribe(function (value) {\r\n              subscribeds.add(observable);\r\n              values.set(observable, [value, null, exports.NowaitState.acquired]);\r\n              scheduleRender();\r\n          }, function (err) {\r\n              subscribeds.add(observable);\r\n              values.set(observable, [null, err, exports.NowaitState.rejected]);\r\n              scheduleRender();\r\n          }, function () {\r\n              var value = values.has(observable)\r\n                  ? values.get(observable)[0]\r\n                  : null;\r\n              subscribeds.add(observable);\r\n              values.set(observable, [value, null, exports.NowaitState.fulfilled]);\r\n              scheduleRender();\r\n          }));\r\n      }\r\n      if (subscribeds.has(observable)) {\r\n          subscribeds.delete(observable);\r\n      }\r\n      return values.get(observable);\r\n  }\r\n  (function (NowaitState) {\r\n      NowaitState[NowaitState[\"pending\"] = 0] = \"pending\";\r\n      NowaitState[NowaitState[\"fulfilled\"] = 1] = \"fulfilled\";\r\n      NowaitState[NowaitState[\"rejected\"] = 2] = \"rejected\";\r\n      NowaitState[NowaitState[\"acquired\"] = 3] = \"acquired\";\r\n  })(exports.NowaitState || (exports.NowaitState = {}));\r\n  function createNowait(scheduleRender, values, subscriptions, subscribeds) {\r\n      return function (mayBeAsync, defaultValue) {\r\n          if (defaultValue === void 0) { defaultValue = null; }\r\n          if (null == mayBeAsync) {\r\n              return [defaultValue, null, exports.NowaitState.fulfilled];\r\n          }\r\n          if (mayBeAsync instanceof Promise) {\r\n              return nowaitPromise(scheduleRender, values, mayBeAsync, defaultValue);\r\n          }\r\n          if (isObservable(mayBeAsync)) {\r\n              return nowaitObservable(scheduleRender, values, subscriptions, subscribeds, mayBeAsync, defaultValue);\r\n          }\r\n          if (mayBeAsync instanceof Error) {\r\n              return [null, mayBeAsync, exports.NowaitState.rejected];\r\n          }\r\n          return [mayBeAsync, null, exports.NowaitState.fulfilled];\r\n      };\r\n  }\r\n  function createNowaitUnsubscribe(subscriptions, subscribeds) {\r\n      return function () {\r\n          subscribeds.forEach(function (target) {\r\n              if (subscriptions.has(target)) {\r\n                  var subscription = subscriptions.get(target);\r\n                  subscriptions.delete(target);\r\n                  subscription.unsubscribe();\r\n              }\r\n          });\r\n          subscribeds.clear();\r\n      };\r\n  }\n\n  function nowaitProvider(scheduleRender) {\r\n      var values = new WeakMap();\r\n      var subscriptions = new Map();\r\n      var subscribeds = new Set();\r\n      return [\r\n          createNowait(scheduleRender, values, subscriptions, subscribeds),\r\n          createNowaitUnsubscribe(subscriptions, subscribeds)\r\n      ];\r\n  }\n\n  function remodelProps(props, context, extra, path) {\r\n      deepSet(props, CONTEXT, context || deepGet(props, CONTEXT) || {});\r\n      deepSet(props, EXTRA, extra || deepGet(props, EXTRA) || {});\r\n      deepSet(props, PATH, path || '');\r\n      return props;\r\n  }\n\n  /*! *****************************************************************************\r\n  Copyright (c) Microsoft Corporation. All rights reserved.\r\n  Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\n  this file except in compliance with the License. You may obtain a copy of the\r\n  License at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\n  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\n  MERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\n  See the Apache Version 2.0 License for specific language governing permissions\r\n  and limitations under the License.\r\n  ***************************************************************************** */\r\n\r\n  var __assign = function() {\r\n      __assign = Object.assign || function __assign(t) {\r\n          for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n              s = arguments[i];\r\n              for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n          }\r\n          return t;\r\n      };\r\n      return __assign.apply(this, arguments);\r\n  };\n\n  function eventProxyProvider(mutate, getContext, eventTargetProps) {\r\n      return function (event) {\r\n          var node = event.currentTarget;\r\n          var props = eventTargetProps.get(node) || {};\r\n          var path = deepGet(props, PATH) || '';\r\n          var detail = event.detail || {};\r\n          var extra = deepGet(props, EXTRA) || {};\r\n          var newContext = props['on' + event.type](getContext(path), __assign({}, extra, detail, { dispatch: function (name, dtl) {\r\n                  if (dtl === void 0) { dtl = {}; }\r\n                  node &&\r\n                      node.dispatchEvent(new CustomEvent(name, {\r\n                          bubbles: true,\r\n                          cancelable: true,\r\n                          detail: dtl\r\n                      }));\r\n              } }), props, event);\r\n          mutate(newContext, path);\r\n      };\r\n  }\n\n  var shouldBeCaptureLifecycles = {};\r\n  shouldBeCaptureLifecycles[REMOVE] = 1;\r\n  shouldBeCaptureLifecycles[DESTROY] = 2;\r\n  function resolveLifecycle(rawLifecycle, captureLifecycle, glueNode, removedNodes) {\r\n      var shouldBeCaptureLifecycle = shouldBeCaptureLifecycles[rawLifecycle];\r\n      var shouldBeCaptureLifecycleByCaptured = shouldBeCaptureLifecycles[captureLifecycle];\r\n      var lifecycle = (shouldBeCaptureLifecycleByCaptured &&\r\n          (!shouldBeCaptureLifecycle ||\r\n              shouldBeCaptureLifecycle < shouldBeCaptureLifecycleByCaptured) &&\r\n          captureLifecycle) ||\r\n          rawLifecycle;\r\n      if (REMOVE == lifecycle) {\r\n          var node = glueNode[NODE];\r\n          return removedNodes.get(node) ||\r\n              (REMOVE == rawLifecycle && !deepGet(glueNode, PROPS + \".on\" + REMOVE))\r\n              ? DESTROY\r\n              : REMOVE;\r\n      }\r\n      return lifecycle;\r\n  }\n\n  function glueNodeMerger(removedNodes, next, recursion, captureLifecycle, vNode, glueNode) {\r\n      if (!glueNode) {\r\n          return createGlueNode(vNode, next, recursion);\r\n      }\r\n      if (!vNode) {\r\n          deepSet(glueNode, PREV_PROPS, glueNode[PROPS]);\r\n          var lifecycle_1 = resolveLifecycle(REMOVE != captureLifecycle && DESTROY != captureLifecycle\r\n              ? REMOVE\r\n              : UPDATE, captureLifecycle, glueNode, removedNodes);\r\n          glueNode[LIFECYCLE] = lifecycle_1;\r\n          glueNode[CHILDREN] = glueNode[CHILDREN].map(function (child) {\r\n              return recursion(lifecycle_1, null, child);\r\n          });\r\n          return glueNode;\r\n      }\r\n      deepSet(glueNode, PREV_PROPS, glueNode[PROPS]);\r\n      glueNode[PROPS] = vNode[PROPS];\r\n      glueNode[KEY] = vNode[KEY];\r\n      glueNode[NAME] = vNode[NAME];\r\n      glueNode[LIFECYCLE] = UPDATE;\r\n      var indexedPrevChildren = glueNode[CHILDREN].map(function (child, i) { return (child.i = i, child); });\r\n      var children = vNode[CHILDREN].map(function (child) {\r\n          var prevChild, _prevChild, i;\r\n          for (i = 0; i < indexedPrevChildren.length; i++) {\r\n              _prevChild = indexedPrevChildren[i];\r\n              if (child[NAME] == _prevChild[NAME] &&\r\n                  child[KEY] == _prevChild[KEY] &&\r\n                  (UPDATE === _prevChild[LIFECYCLE] || CREATE === _prevChild[LIFECYCLE])) {\r\n                  prevChild = _prevChild;\r\n                  break;\r\n              }\r\n          }\r\n          if (prevChild) {\r\n              indexedPrevChildren.splice(i, 1);\r\n              return recursion(UPDATE, child, prevChild);\r\n          }\r\n          else {\r\n              return recursion(UPDATE, child);\r\n          }\r\n      });\r\n      indexedPrevChildren.map(function (child) {\r\n          child = recursion(UPDATE, null, child);\r\n          if (0 === child.i) {\r\n              children.unshift(child);\r\n          }\r\n          else {\r\n              var index = child.i - 1;\r\n              var i = void 0;\r\n              for (i = 0; i < children.length; i++) {\r\n                  if (index === children[i].i) {\r\n                      children.splice(i + 1, 0, child);\r\n                      return;\r\n                  }\r\n              }\r\n              children.push(child);\r\n          }\r\n      });\r\n      glueNode[CHILDREN] = children;\r\n      return glueNode;\r\n  }\n\n  function glueNodeMergerProvider(removedNodes) {\r\n      return function (next, recursion) { return function (captureLifecycle, vNode, glueNode) {\r\n          return glueNodeMerger(removedNodes, next, recursion, captureLifecycle, vNode, glueNode);\r\n      }; };\r\n  }\n\n  function updateAttribute(element, name, value, oldValue, isSVG, eventProxy) {\r\n      if (name[0] === 'o' && name[1] === 'n') {\r\n          var eventName = name.slice(2);\r\n          if (!(value instanceof Function)) {\r\n              element.removeEventListener(eventName, eventProxy);\r\n          }\r\n          else if (!(oldValue instanceof Function)) {\r\n              element.addEventListener(eventName, eventProxy);\r\n          }\r\n      }\r\n      else if (!isSVG && name !== 'list' && name in element) {\r\n          element[name] = value == null ? '' : value;\r\n      }\r\n      else if (value == null || value === false) {\r\n          element.removeAttribute(name);\r\n      }\r\n      else {\r\n          element.setAttribute(name, value);\r\n      }\r\n  }\n\n  function createNode(glueNode, isSVG, eventProxy, eventTargetProps) {\r\n      var props = glueNode[PROPS] || {};\r\n      if (glueNode[NAME] === TEXT_NODE) {\r\n          return document.createTextNode(deepGet(props, TEXT));\r\n      }\r\n      isSVG = isSVG || glueNode[NAME] === 'svg';\r\n      var node = isSVG\r\n          ? document.createElementNS('http://www.w3.org/2000/svg', glueNode[NAME])\r\n          : document.createElement(glueNode[NAME]);\r\n      for (var name_1 in props) {\r\n          if (OBJECT != typeof props[name_1]) {\r\n              updateAttribute(node, name_1, props[name_1], null, isSVG, eventProxy);\r\n          }\r\n      }\r\n      eventTargetProps.set(node, props);\r\n      return node;\r\n  }\n\n  function fireLifeCycleEventProvider(elm, type, detail) {\r\n      if (detail === void 0) { detail = {}; }\r\n      var events = [\r\n          new CustomEvent('lifecycle', { detail: assign({ type: type }, detail) }),\r\n          new CustomEvent(type, { detail: detail })\r\n      ];\r\n      return function () { return events.map(function (event) { return elm.dispatchEvent(event); }); };\r\n  }\n\n  function updateNode(glueNode, isSVG, eventProxy, eventTargetProps) {\r\n      var node = glueNode[NODE];\r\n      var props = glueNode[PROPS];\r\n      var prevProps = deepGet(glueNode, PREV_PROPS) || {};\r\n      var updated = false;\r\n      if (glueNode[NAME] === TEXT_NODE) {\r\n          var value = deepGet(props, TEXT);\r\n          var oldValue = deepGet(prevProps, TEXT);\r\n          updated = value != oldValue;\r\n          if (updated) {\r\n              node.nodeValue = deepGet(props, TEXT);\r\n          }\r\n          return [node, updated];\r\n      }\r\n      for (var name_1 in assign(assign({}, props), prevProps)) {\r\n          if (OBJECT != typeof props[name_1] &&\r\n              props[name_1] !==\r\n                  (name_1 === 'value' || name_1 === 'checked' ? node[name_1] : prevProps[name_1])) {\r\n              updateAttribute(node, name_1, props[name_1], prevProps[name_1], isSVG, eventProxy);\r\n              updated = true;\r\n          }\r\n      }\r\n      eventTargetProps.set(node, props);\r\n      return [node, updated];\r\n  }\n\n  function patcher(mutate, lifecycleEvents, eventProxy, eventTargetProps, removedNodes, next, recursion, glueNode, isSVG) {\r\n      var _a;\r\n      var newGlueNode = assign({}, glueNode);\r\n      var node = glueNode[NODE];\r\n      if (!isSVG && glueNode[NAME] === 'svg') {\r\n          isSVG = true;\r\n      }\r\n      var lifecycle = newGlueNode[LIFECYCLE];\r\n      var lifecycleEvent;\r\n      var detail = null;\r\n      switch (lifecycle) {\r\n          case CREATE:\r\n              lifecycleEvent = true;\r\n              node = createNode(glueNode, isSVG, eventProxy, eventTargetProps);\r\n              break;\r\n          case UPDATE:\r\n              _a = updateNode(glueNode, isSVG, eventProxy, eventTargetProps), node = _a[0], lifecycleEvent = _a[1];\r\n              break;\r\n          case DESTROY:\r\n              fireLifeCycleEventProvider(node, lifecycle, detail)();\r\n              var parent_1 = node.parentElement || node.parentNode;\r\n              parent_1 && parent_1.removeChild(node);\r\n              break;\r\n          case REMOVE:\r\n              if (!removedNodes.has(node)) {\r\n                  removedNodes.set(node, false);\r\n                  lifecycleEvent = true;\r\n                  detail = {\r\n                      done: function () {\r\n                          removedNodes.set(node, true);\r\n                          Promise.resolve({}).then(mutate);\r\n                      }\r\n                  };\r\n              }\r\n      }\r\n      if (lifecycleEvent) {\r\n          lifecycleEvents.push(fireLifeCycleEventProvider(node, lifecycle, detail));\r\n      }\r\n      var children = glueNode[CHILDREN].reduce(function (acc, childNode) {\r\n          var patchedChild = recursion(childNode, isSVG);\r\n          return patchedChild ? acc.concat(patchedChild) : acc;\r\n      }, []);\r\n      if (lifecycle === DESTROY) {\r\n          return null;\r\n      }\r\n      children\r\n          .map(function (v) { return v[NODE]; })\r\n          .reduceRight(function (ref, elm) {\r\n          if (elm.parentNode !== node || elm.nextSibling !== ref) {\r\n              node.insertBefore(elm, ref);\r\n          }\r\n          return elm;\r\n      }, null);\r\n      newGlueNode[CHILDREN] = children;\r\n      newGlueNode[NODE] = node;\r\n      return newGlueNode;\r\n  }\n\n  function patcherProvider(mutate, lifecycleEvents, eventProxy, eventTargetProps, removedNodes) {\r\n      return function (next, recursion) { return function (glueNode, isSVG) {\r\n          return patcher(mutate, lifecycleEvents, eventProxy, eventTargetProps, removedNodes, next, recursion, glueNode, isSVG);\r\n      }; };\r\n  }\n\n  var nameTypes = [STRING, FUNCTION];\r\n  function isVNode(value) {\r\n      return (null != value &&\r\n          OBJECT === typeof value &&\r\n          PROPS in value &&\r\n          CHILDREN in value &&\r\n          KEY in value &&\r\n          NAME in value &&\r\n          OBJECT === typeof value[PROPS] &&\r\n          OBJECT === typeof value[CHILDREN] &&\r\n          'length' in value[CHILDREN] &&\r\n          (value[KEY] == null || STRING === typeof value[KEY]) &&\r\n          0 <= nameTypes.indexOf(typeof value[NAME]));\r\n  }\n\n  /**\r\n   * x\r\n   *\r\n   * @param  name {string | Component}\r\n   * @param  props {object}\r\n   * @param  ... {object}\r\n   * @return {VNode}\r\n   */\r\n  function x(name, props) {\r\n      var rest = [];\r\n      for (var _i = 2; _i < arguments.length; _i++) {\r\n          rest[_i - 2] = arguments[_i];\r\n      }\r\n      var children = [];\r\n      while (rest.length) {\r\n          var node = rest.pop();\r\n          if (node && Array.isArray(node)) {\r\n              rest = rest.concat(node);\r\n          }\r\n          else if (node != null && node !== true && node !== false) {\r\n              children.unshift((isVNode(node) && node) || createVNode(true, node));\r\n          }\r\n      }\r\n      return createVNode(false, name, props || {}, children);\r\n  }\n\n  function resolveChildren(_, recursion, children, parentNode) {\r\n      return children.reduce(function (childs, child) {\r\n          childs.push.apply(childs, recursion(child, parentNode));\r\n          return childs;\r\n      }, []);\r\n  }\r\n  function resolver(getContext, setContext, next, recursion, node, parentNode) {\r\n      if (!node) {\r\n          return [];\r\n      }\r\n      if (x === node.name) {\r\n          // Fragment\r\n          return resolveChildren(next, recursion, node[CHILDREN], parentNode);\r\n      }\r\n      var rawProps = node[PROPS];\r\n      var parentProps = (parentNode && parentNode[PROPS]) || {};\r\n      var path = deepGet(rawProps, PATH);\r\n      if (!path) {\r\n          var parentPath = deepGet(parentProps, PATH) || '';\r\n          var slice = deepGet(rawProps, SLICE);\r\n          if (slice != null) {\r\n              slice = \"\" + slice;\r\n          }\r\n          path =\r\n              parentPath && slice\r\n                  ? parentPath + \".\" + slice\r\n                  : (slice || parentPath);\r\n      }\r\n      var sliced = getContext(path, false);\r\n      if (!sliced) {\r\n          sliced = {};\r\n          setContext(sliced, path);\r\n      }\r\n      var fill = deepGet(rawProps, FILL);\r\n      if (fill) {\r\n          for (var key in fill) {\r\n              if (fill.hasOwnProperty(key) && !(key in sliced)) {\r\n                  sliced[key] = fill[key];\r\n              }\r\n          }\r\n      }\r\n      var context = sliced;\r\n      var extra = assign(assign({}, deepGet(rawProps, EXTRA) || {}), (parentNode && deepGet(parentNode, PROPS + \".\" + EXTRA)) || {});\r\n      var props = remodelProps(rawProps, context, extra, path);\r\n      var nodes;\r\n      if (typeof node.name === FUNCTION) {\r\n          var proceeded = node.name(props, node[CHILDREN], context, extra);\r\n          nodes = isVNode(proceeded) ? recursion(proceeded, node) : [];\r\n      }\r\n      else {\r\n          nodes = [node];\r\n      }\r\n      var resolveds = nodes.reduce(function (acc, resolved) {\r\n          if (isVNode(resolved)) {\r\n              resolved[CHILDREN] = resolveChildren(next, recursion, resolved[CHILDREN], resolved);\r\n              acc.push(resolved);\r\n          }\r\n          return acc;\r\n      }, []);\r\n      return resolveds;\r\n  }\n\n  function resolverProvider(getContext, setContext) {\r\n      return function (next, recursion) { return function (node, parentNode) { return resolver(getContext, setContext, next, recursion, node, parentNode); }; };\r\n  }\n\n  function rendererProvider(mutate, getContext, setContext /*, view, glueNode */) {\r\n      var eventTargetProps = new WeakMap();\r\n      var removedNodes = new WeakMap();\r\n      var eventProxy = eventProxyProvider(mutate, getContext, eventTargetProps);\r\n      return function () {\r\n          var lifecycleEvents = [];\r\n          return [\r\n              // resolver\r\n              resolverProvider(getContext, setContext),\r\n              // meger\r\n              glueNodeMergerProvider(removedNodes),\r\n              // pather\r\n              patcherProvider(mutate, lifecycleEvents, eventProxy, eventTargetProps, removedNodes),\r\n              // finallyer\r\n              function () { return function () {\r\n                  lifecycleEvents.reduceRight(function (_, lifecycleEvent) { return lifecycleEvent(); }, 0);\r\n              }; }\r\n          ];\r\n      };\r\n  }\n\n  function rendering(glueNode, view, extra, renderers) {\r\n      var resolverRecursion = function () {\r\n          var args = [];\r\n          for (var _i = 0; _i < arguments.length; _i++) {\r\n              args[_i] = arguments[_i];\r\n          }\r\n          return resolver.apply(null, args);\r\n      };\r\n      var resolver = renderers\r\n          .map(function (v) { return v[0]; })\r\n          .reduce(wrapOnion, [\r\n          (function () { return []; }),\r\n          resolverRecursion\r\n      ])[0];\r\n      var glueNodeMergerRecursion = function () {\r\n          var args = [];\r\n          for (var _i = 0; _i < arguments.length; _i++) {\r\n              args[_i] = arguments[_i];\r\n          }\r\n          return glueNodeMerger.apply(null, args);\r\n      };\r\n      var glueNodeMerger = renderers\r\n          .map(function (v) { return v[1]; })\r\n          .reduce(wrapOnion, [noop, glueNodeMergerRecursion])[0];\r\n      var patcherRecursion = function () {\r\n          var args = [];\r\n          for (var _i = 0; _i < arguments.length; _i++) {\r\n              args[_i] = arguments[_i];\r\n          }\r\n          return patcher.apply(null, args);\r\n      };\r\n      var patcher = renderers\r\n          .map(function (v) { return v[2]; })\r\n          .reduce(wrapOnion, [noop, patcherRecursion])[0];\r\n      var finallyer = renderers.map(function (v) { return v[3]; }).reduce(wrapOnion, [noop, noop])[0];\r\n      var vNodes = resolver(x(view, { xa: { extra: extra } }, []));\r\n      var container = assign({}, glueNode);\r\n      container[CHILDREN] = vNodes;\r\n      var node = glueNodeMerger(UPDATE, container, glueNode);\r\n      glueNode = patcher(node, 'svg' === node.name);\r\n      finallyer();\r\n      return glueNode;\r\n  }\r\n  function wrapOnion(_a, stack) {\r\n      var next = _a[0], recursion = _a[1];\r\n      return [stack ? stack(next, recursion) : next, recursion];\r\n  }\n\n  /**\r\n   * atto\r\n   *\r\n   * @param  view Component\r\n   * @param  containerOrGlueNode Element | GlueNode\r\n   * @param  options object default: `{}`\r\n   * @return (context: any, path?: string) => void\r\n   */\r\n  function atto(view, containerOrGlueNode, options) {\r\n      if (options === void 0) { options = {}; }\r\n      var scheduled = false;\r\n      var renderNow = false;\r\n      var rerender = false;\r\n      var glueNode = containerOrGlueNode instanceof Element\r\n          ? createGlueNodeByElement(containerOrGlueNode)\r\n          : containerOrGlueNode;\r\n      var rootProps = remodelProps(glueNode[PROPS]);\r\n      var rootContext = deepGet(rootProps, CONTEXT);\r\n      var middlewares = (MIDDLEWARES in options && options[MIDDLEWARES]) || [];\r\n      var mutate = mutateProvider(getContext, setContext, scheduleRender);\r\n      var _a = nowaitProvider(scheduleRender), nowait = _a[0], nowaitUnsubscribe = _a[1];\r\n      var extra = { mutate: mutate, nowait: nowait };\r\n      var rendererProviders = [rendererProvider]\r\n          .concat(middlewares)\r\n          .map(function (provider) {\r\n          return provider(mutate, getContext, setContext, view, glueNode);\r\n      });\r\n      function getContext(path, def) {\r\n          if (def === void 0) { def = {}; }\r\n          return (path ? deepGet(rootContext, path) : rootContext) || def;\r\n      }\r\n      function setContext(newContext, path) {\r\n          if (path) {\r\n              deepSet(rootContext, path, newContext);\r\n          }\r\n          else {\r\n              rootContext = newContext;\r\n          }\r\n      }\r\n      function render() {\r\n          renderNow = true;\r\n          glueNode = rendering(glueNode, view, extra, rendererProviders.map(function (provider) { return provider(); }));\r\n      }\r\n      function rendered() {\r\n          renderNow = scheduled = false;\r\n          if (rerender) {\r\n              rerender = false;\r\n              scheduleRender();\r\n          }\r\n          else {\r\n              nowaitUnsubscribe();\r\n          }\r\n      }\r\n      function renderedError(e) {\r\n          rendered();\r\n          throw e;\r\n      }\r\n      function scheduleRender() {\r\n          if (!scheduled) {\r\n              scheduled = true;\r\n              Promise.resolve()\r\n                  .then(render)\r\n                  .then(rendered, renderedError);\r\n          }\r\n          else if (renderNow) {\r\n              rerender = true;\r\n          }\r\n      }\r\n      return mutate;\r\n  }\n\n  function Context(_a, children) {\r\n      var slice = _a.slice, fill = _a.fill;\r\n      return x(ContextInner, { xa: { slice: slice, fill: fill }, children: children });\r\n  }\r\n  function ContextInner(_a) {\r\n      var children = _a.children;\r\n      return x(x, {}, children);\r\n  }\n\n  /**\r\n   * @param  eventHandler {Function}\r\n   * @return {Function}\r\n   */\r\n  function currentOnly(eventHandler) {\r\n      return function (context, detail, props, event) {\r\n          if (event.currentTarget === event.target) {\r\n              return eventHandler(context, detail, props, event);\r\n          }\r\n      };\r\n  }\n\n  function Extra(props, children) {\r\n      return x(ExtraInner, { xa: { extra: props }, children: children });\r\n  }\r\n  function ExtraInner(_a) {\r\n      var children = _a.children;\r\n      return x(x, {}, children);\r\n  }\n\n  exports.atto = atto;\n  exports.Context = Context;\n  exports.currentOnly = currentOnly;\n  exports.Extra = Extra;\n  exports.x = x;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n"]}
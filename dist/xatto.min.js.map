{"version":3,"sources":["dist/xatto.js"],"names":["global","factory","exports","module","define","amd","xatto","this","CHILDREN","KEY","NAME","PROPS","CONTEXT","EXTRA","SLICE","TEXT","ELEMENT","LIFECYCLE","PREV_PROPS","PREV","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","CREATE","DESTROY","REMOVE","REMOVING","UPDATE","deepSet","target","key","value","separator","idx","indexOf","current","slice","nexts","next","split","parseInt","createGlueNode","vNode","newGlueNode","map","child","TEXT_NODE","createVNode","mayBeTextNode","name","props","children","node","deepGet","lifeCycleEventPath","XLINK_NS","updateAttribute","element","oldValue","isSVG","eventProxy","elementProps","eventName","removeEventListener","addEventListener","nullOrFalse","removeAttribute","ns","originName","replace","setAttribute","setAttributeNS","removeAttributeNS","partial","fn","args","backwardArgs","_i","concat","patcher","patchStack","glueNode","isDestroy","reduce","acc","childNode","patchedChild","document","createTextNode","createElementNS","createElement","name_1","set","nodeValue","prevAttributes","updateElement","parentElement","removeChild","v","reduceRight","ref","elm","insertBefore","pickupLifecycleEvents","lifecycleEvents","mutate","lifecycleEvent","onremove_1","done_1","Promise","resolve","then","attrs","prevAttrs","push","remodelProps","context","extra","isVNode","keys","x","rest","pop","Array","isArray","unshift","resolveChildren","parentNode","childs","resolveNode","sliced","rawProps","path","defaultValue","resolved","atto","view","elementOrGlueNode","scheduled","Element","nodeName","rootProps","rootContext","WeakMap","actualContext","newContext","targetContext_1","entries","_a","k","render","rendered","renderedError","event","currentTarget","get","type","mergeGlueNode","indexedPrevChildren","prevChild","_prevChild","splice","_","undefined","index","patchStacks","stack","e"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n    (factory((global.xatto = {})));\n}(this, (function (exports) { 'use strict';\n\n    var CHILDREN = 'children';\r\n    var KEY = 'key';\r\n    var NAME = 'name';\r\n    var PROPS = 'props';\n\n    var CONTEXT = 'xa.context';\r\n    var EXTRA = 'xa.extra';\r\n    var SLICE = 'xa.slice';\r\n    var TEXT = 'xa.text';\n\n    var ELEMENT = 'element';\r\n    var LIFECYCLE = 'lifecycle';\r\n    var PREV = 'prev';\r\n    var PREV_PROPS = PREV + \".\" + PROPS;\n\n    /*! *****************************************************************************\r\n    Copyright (c) Microsoft Corporation. All rights reserved.\r\n    Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\n    this file except in compliance with the License. You may obtain a copy of the\r\n    License at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\n    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\n    MERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\n    See the Apache Version 2.0 License for specific language governing permissions\r\n    and limitations under the License.\r\n    ***************************************************************************** */\r\n\r\n    var __assign = function() {\r\n        __assign = Object.assign || function __assign(t) {\r\n            for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n                s = arguments[i];\r\n                for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n            }\r\n            return t;\r\n        };\r\n        return __assign.apply(this, arguments);\r\n    };\n\n    var CREATE = 'create';\r\n    var DESTROY = 'destroy';\r\n    var REMOVE = 'remove';\r\n    var REMOVING = 'removing';\r\n    var UPDATE = 'update';\n\n    /**\r\n     * Set an object item to a given value using separator notation.\r\n     *\r\n     * @param {any} target\r\n     * @param {string} key\r\n     * @param {any} value\r\n     * @param {string} separator\r\n     * @return {boolean}\r\n     */\r\n    function deepSet(target, key, value, separator) {\r\n        if (separator === void 0) { separator = '.'; }\r\n        while (true) {\r\n            if ('object' !== typeof target) {\r\n                return false;\r\n            }\r\n            var idx = key.indexOf(separator);\r\n            if (idx < 0) {\r\n                target[key] = value;\r\n                return true;\r\n            }\r\n            var current = key.slice(0, idx);\r\n            var nexts = key.slice(idx + 1);\r\n            if (null == target[current]) {\r\n                var next = nexts.split(separator, 1)[0];\r\n                target[current] = next === \"\" + parseInt(next, 10) ? [] : {};\r\n            }\r\n            target = target[current];\r\n            key = nexts;\r\n        }\r\n    }\n\n    function createGlueNode(vNode) {\r\n        var newGlueNode = __assign({}, vNode);\r\n        newGlueNode.i = 0;\r\n        newGlueNode[LIFECYCLE] = CREATE;\r\n        newGlueNode[CHILDREN] = vNode[CHILDREN].map(function (child) { return createGlueNode(child); });\r\n        deepSet(newGlueNode, PREV_PROPS, {});\r\n        return newGlueNode;\r\n    }\n\n    var TEXT_NODE = 'xa-txt';\n\n    function createVNode(mayBeTextNode, name, props, children) {\r\n        if (props === void 0) { props = {}; }\r\n        if (children === void 0) { children = []; }\r\n        var node = {};\r\n        node[NAME] = name;\r\n        node[PROPS] = props;\r\n        node[CHILDREN] = children;\r\n        node[KEY] = props.key;\r\n        if (mayBeTextNode && 'function' !== typeof name) {\r\n            node[NAME] = TEXT_NODE;\r\n            deepSet(node[PROPS], TEXT, name);\r\n        }\r\n        return node;\r\n    }\n\n    function createGlueNodeByElement(element) {\r\n        var node = createGlueNode(createVNode(false, element.nodeName));\r\n        node[ELEMENT] = element;\r\n        return node;\r\n    }\n\n    /**\r\n     * Get an item from an object using separator notation.\r\n     *\r\n     * @typeparam {T}\r\n     * @param {any} target\r\n     * @param {string} key\r\n     * @param {string} separator\r\n     * @return {T}\r\n     */\r\n    function deepGet(target, key, separator) {\r\n        if (separator === void 0) { separator = '.'; }\r\n        while (true) {\r\n            if (target == null) {\r\n                return target;\r\n            }\r\n            var idx = key.indexOf(separator);\r\n            if (idx < 0) {\r\n                return target[key];\r\n            }\r\n            target = target[key.slice(0, idx)];\r\n            key = key.slice(idx + 1);\r\n        }\r\n    }\n\n    var lifeCycleEventPath = function (name) { return PROPS + \".on\" + name; };\n\n    function mergeGlueNode(vNode, glueNode) {\r\n        if (!glueNode) {\r\n            return createGlueNode(vNode);\r\n        }\r\n        if (!vNode) {\r\n            deepSet(glueNode, PREV_PROPS, glueNode[PROPS]);\r\n            glueNode[LIFECYCLE] = (glueNode[LIFECYCLE] === REMOVING || glueNode[LIFECYCLE] === DESTROY)\r\n                ? glueNode[LIFECYCLE]\r\n                : (deepGet(glueNode, lifeCycleEventPath(REMOVE))\r\n                    ? REMOVE\r\n                    : DESTROY);\r\n            return glueNode;\r\n        }\r\n        deepSet(glueNode, PREV_PROPS, glueNode[PROPS]);\r\n        glueNode[PROPS] = vNode[PROPS];\r\n        glueNode[KEY] = vNode[KEY];\r\n        glueNode[NAME] = vNode[NAME];\r\n        glueNode[LIFECYCLE] = UPDATE;\r\n        var indexedPrevChildren = glueNode[CHILDREN].map(function (child, i) { return (child.i = i, child); });\r\n        var children = vNode[CHILDREN].map(function (child) {\r\n            var prevChild, _prevChild, i;\r\n            for (i = 0; i < indexedPrevChildren.length; i++) {\r\n                _prevChild = indexedPrevChildren[i];\r\n                if (child[NAME] == _prevChild[NAME]\r\n                    && child[KEY] == _prevChild[KEY]\r\n                    && (UPDATE === _prevChild[LIFECYCLE] || CREATE === _prevChild[LIFECYCLE])) {\r\n                    prevChild = _prevChild;\r\n                    break;\r\n                }\r\n            }\r\n            if (prevChild) {\r\n                indexedPrevChildren.splice(i, 1);\r\n                return mergeGlueNode(child, prevChild);\r\n            }\r\n            else {\r\n                return mergeGlueNode(child);\r\n            }\r\n        });\r\n        indexedPrevChildren.reduceRight(function (_, child) {\r\n            child = mergeGlueNode(undefined, child);\r\n            if (0 === child.i) {\r\n                children.unshift(child);\r\n            }\r\n            else {\r\n                var index = child.i - 1;\r\n                var i = void 0;\r\n                for (i = 0; i < children.length; i++) {\r\n                    if (index === children[i].i) {\r\n                        children.splice(i + 1, 0, child);\r\n                        return 0;\r\n                    }\r\n                }\r\n                children.push(child);\r\n            }\r\n            return 0;\r\n        }, 0);\r\n        glueNode[CHILDREN] = children;\r\n        return glueNode;\r\n    }\n\n    var XLINK_NS = \"http://www.w3.org/1999/xlink\";\n\n    function updateAttribute(element, name, value, oldValue, isSVG, eventProxy, elementProps) {\r\n        if (name === \"key\" || 'object' === typeof value) {\r\n            // noop\r\n        }\r\n        else {\r\n            if (name[0] === \"o\" && name[1] === \"n\") {\r\n                var eventName = name.slice(2);\r\n                if (value == null) {\r\n                    element.removeEventListener(eventName, eventProxy);\r\n                }\r\n                else if (oldValue == null) {\r\n                    element.addEventListener(eventName, eventProxy);\r\n                }\r\n            }\r\n            else {\r\n                var nullOrFalse = value == null || value === false;\r\n                if (name in element &&\r\n                    name !== \"list\" &&\r\n                    name !== \"draggable\" &&\r\n                    name !== \"spellcheck\" &&\r\n                    name !== \"translate\" &&\r\n                    !isSVG) {\r\n                    if (nullOrFalse) {\r\n                        element.removeAttribute(name);\r\n                    }\r\n                    else {\r\n                        element[name] = value == null ? \"\" : value;\r\n                    }\r\n                }\r\n                else {\r\n                    var ns = false;\r\n                    if (isSVG) {\r\n                        var originName = name;\r\n                        name = name.replace(/^xlink:?/, \"\");\r\n                        ns = name !== originName;\r\n                    }\r\n                    switch ((nullOrFalse ? 1 : 0) + ((ns ? 1 : 0) << 1)) {\r\n                        case 0:\r\n                            element.setAttribute(name, value);\r\n                            break;\r\n                        case 1:\r\n                            element.removeAttribute(name);\r\n                            break;\r\n                        case 2:\r\n                            element.setAttributeNS(XLINK_NS, name, value);\r\n                            break;\r\n                        case 3:\r\n                            element.removeAttributeNS(XLINK_NS, name);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\n\n    function createElement(node, isSVG, eventProxy, elementProps) {\r\n        var props = node[PROPS] || {};\r\n        if (node[NAME] === TEXT_NODE) {\r\n            return document.createTextNode(deepGet(props, TEXT));\r\n        }\r\n        var element = (isSVG = isSVG || node[NAME] === \"svg\")\r\n            ? document.createElementNS(\"http://www.w3.org/2000/svg\", node[NAME])\r\n            : document.createElement(node[NAME]);\r\n        for (var name_1 in props) {\r\n            updateAttribute(element, name_1, props[name_1], null, isSVG, eventProxy, elementProps);\r\n        }\r\n        elementProps.set(element, props);\r\n        return element;\r\n    }\n\n    function apply(fn, args) {\r\n        return fn.apply(null, args);\r\n    }\n\n    function partial(fn, args) {\r\n        return function () {\r\n            var backwardArgs = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                backwardArgs[_i] = arguments[_i];\r\n            }\r\n            return apply(fn, args.concat(backwardArgs));\r\n        };\r\n    }\n\n    function updateElement(node, isSVG, eventProxy, elementProps) {\r\n        var element = node[ELEMENT];\r\n        var props = node[PROPS];\r\n        if (node[NAME] === TEXT_NODE) {\r\n            element.nodeValue = deepGet(props, TEXT);\r\n            return element;\r\n        }\r\n        var prevAttributes = deepGet(node, PREV_PROPS) || {};\r\n        for (var name_1 in props) {\r\n            if (props[name_1] !==\r\n                (name_1 === \"value\" || name_1 === \"checked\"\r\n                    ? element[name_1]\r\n                    : prevAttributes[name_1])) {\r\n                updateAttribute(element, name_1, props[name_1], prevAttributes[name_1], isSVG, eventProxy, elementProps);\r\n            }\r\n        }\r\n        elementProps.set(element, props);\r\n        return element;\r\n    }\n\n    function patcher(patchStack, glueNode, isSVG, eventProxy, elementProps, isDestroy) {\r\n        var element;\r\n        if (!isSVG && glueNode[NAME] === 'svg') {\r\n            isSVG = true;\r\n        }\r\n        if (!isDestroy && glueNode[LIFECYCLE] === DESTROY) {\r\n            isDestroy = true;\r\n        }\r\n        var children = glueNode[CHILDREN].reduce(function (acc, childNode) {\r\n            var patchedChild = patchStack(childNode, isSVG, eventProxy, elementProps, isDestroy);\r\n            return patchedChild ? acc.concat(patchedChild) : acc;\r\n        }, []);\r\n        var lifecycle = isDestroy ? DESTROY : glueNode[LIFECYCLE];\r\n        switch (lifecycle) {\r\n            case CREATE:\r\n                element = createElement(glueNode, isSVG, eventProxy, elementProps);\r\n                break;\r\n            case UPDATE:\r\n                element = updateElement(glueNode, isSVG, eventProxy, elementProps);\r\n                break;\r\n            case DESTROY:\r\n                if (glueNode[LIFECYCLE] === DESTROY) {\r\n                    element = glueNode[ELEMENT];\r\n                    element.parentElement.removeChild(element);\r\n                }\r\n                return null;\r\n            case REMOVE:\r\n                glueNode[LIFECYCLE] = REMOVING;\r\n            default:\r\n                element = glueNode[ELEMENT];\r\n        }\r\n        children.map(function (v) { return v.element; }).reduceRight(function (ref, elm) {\r\n            element.insertBefore(elm, ref);\r\n            return elm;\r\n        }, null);\r\n        glueNode[CHILDREN] = children;\r\n        glueNode[ELEMENT] = element;\r\n        return glueNode;\r\n    }\r\n    function patch( /* mutate: Function */) {\r\n        return [\r\n            // patch stack\r\n            function (patchStack) { return partial(patcher, [patchStack]); }\r\n            // There is no post-treatment\r\n        ];\r\n    }\n\n    function pickupLifecycleEvents(lifecycleEvents, mutate, patchStack, glueNode, isSVG, eventProxy, elementProps, isDestroy) {\r\n        var lifecycle = isDestroy ? DESTROY : glueNode[LIFECYCLE];\r\n        var lifecycleEvent;\r\n        switch (lifecycle) {\r\n            case CREATE:\r\n                lifecycleEvent = deepGet(glueNode, lifeCycleEventPath(CREATE));\r\n                break;\r\n            case UPDATE:\r\n                lifecycleEvent = deepGet(glueNode, lifeCycleEventPath(UPDATE));\r\n                break;\r\n            case REMOVE:\r\n                var onremove_1 = deepGet(glueNode, lifeCycleEventPath(REMOVE));\r\n                var done_1 = function () {\r\n                    glueNode[LIFECYCLE] = DESTROY;\r\n                    Promise.resolve().then(mutate);\r\n                };\r\n                lifecycleEvent = function (element, attrs, prevAttrs) {\r\n                    onremove_1(element, done_1, attrs, prevAttrs);\r\n                };\r\n                break;\r\n            case DESTROY:\r\n                lifecycleEvent = deepGet(glueNode, lifeCycleEventPath(DESTROY));\r\n                break;\r\n        }\r\n        if (lifecycleEvent) {\r\n            lifecycleEvents.push(function () {\r\n                lifecycleEvent(glueNode[ELEMENT], glueNode[PROPS], deepGet(glueNode, PREV_PROPS));\r\n            });\r\n        }\r\n        return patchStack(glueNode, isSVG, eventProxy, elementProps, isDestroy);\r\n    }\r\n    function pickLifecycleEvents(mutate) {\r\n        var lifecycleEvents = [];\r\n        return [\r\n            function (stack) { return partial(pickupLifecycleEvents, [lifecycleEvents, mutate, stack]); },\r\n            // finally\r\n            function () { return lifecycleEvents.reduce(function (_, lifecycleEvent) { return lifecycleEvent(); }, 0); }\r\n        ];\r\n    }\n\n    function remodelProps(props, context, extra, slice) {\r\n        deepSet(props, CONTEXT, context || deepGet(props, CONTEXT) || {});\r\n        deepSet(props, EXTRA, extra || deepGet(props, EXTRA) || {});\r\n        deepSet(props, SLICE, slice || deepGet(props, SLICE) || []);\r\n        return props;\r\n    }\n\n    function isVNode(value) {\r\n        return null != value\r\n            && 'object' === typeof value\r\n            && PROPS in value\r\n            && CHILDREN in value\r\n            && KEY in value\r\n            && NAME in value\r\n            && 4 === Object.keys(value).length;\r\n    }\n\n    function x(name, props) {\r\n        var rest = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            rest[_i - 2] = arguments[_i];\r\n        }\r\n        var children = [];\r\n        while (rest.length) {\r\n            var node = rest.pop();\r\n            if (node && Array.isArray(node)) {\r\n                rest = rest.concat(node);\r\n            }\r\n            else if (node != null && node !== true && node !== false) {\r\n                children.unshift(isVNode(node) && node || createVNode(true, node));\r\n            }\r\n        }\r\n        return createVNode(false, name, props || {}, children);\r\n    }\n\n    function resolveChildren(children, parentNode) {\r\n        return children.reduce(function (childs, child) {\r\n            childs.push.apply(childs, resolveNode(child, parentNode));\r\n            return childs;\r\n        }, []);\r\n    }\r\n    function resolveNode(node, parentNode) {\r\n        if (!node) {\r\n            return [];\r\n        }\r\n        if (x === node.name) { // Fragment\r\n            return resolveChildren(node[CHILDREN], parentNode);\r\n        }\r\n        var rawProps = node[PROPS];\r\n        var context = deepGet(rawProps, CONTEXT)\r\n            || (parentNode && deepGet(parentNode, PROPS + \".\" + CONTEXT))\r\n            || {};\r\n        var slice = deepGet(rawProps, SLICE);\r\n        var sliced;\r\n        if ('object' !== typeof slice) {\r\n            slice = [slice];\r\n        }\r\n        var path = slice[0];\r\n        if (path) {\r\n            sliced = deepGet(context, path);\r\n            if (!sliced) {\r\n                var defaultValue = slice[1] || {};\r\n                sliced = __assign({}, defaultValue);\r\n                deepSet(context, path, sliced);\r\n            }\r\n            context = sliced;\r\n        }\r\n        var extra = __assign({}, (deepGet(rawProps, EXTRA) || {}), (parentNode && deepGet(parentNode, PROPS + \".\" + EXTRA) || {}));\r\n        var props = remodelProps(rawProps, context, extra, []);\r\n        var resolveds = (typeof node.name === \"function\"\r\n            ? resolveNode(node.name(props, node[CHILDREN]), node)\r\n            : [node]).reduce(function (acc, resolved) {\r\n            if (isVNode(resolved)) {\r\n                resolved[CHILDREN] = resolveChildren(resolved[CHILDREN], resolved);\r\n                acc.push(resolved);\r\n            }\r\n            return acc;\r\n        }, []);\r\n        return resolveds;\r\n    }\n\n    function atto(view, elementOrGlueNode) {\r\n        var scheduled = false;\r\n        var glueNode = elementOrGlueNode instanceof Element\r\n            ? createGlueNodeByElement(elementOrGlueNode)\r\n            : elementOrGlueNode;\r\n        var rootProps = remodelProps(glueNode[PROPS]);\r\n        var rootContext = deepGet(rootProps, CONTEXT);\r\n        var elementProps = new WeakMap();\r\n        function mutate(context, actualContext, path) {\r\n            if (context === void 0) { context = null; }\r\n            if (actualContext === void 0) { actualContext = rootContext; }\r\n            if (path === void 0) { path = null; }\r\n            if (context && context !== actualContext) {\r\n                if ('function' === typeof context) {\r\n                    return context(mutate, actualContext, rootContext);\r\n                }\r\n                else if (context instanceof Promise) {\r\n                    return context.then(function (newContext) { return mutate(newContext, actualContext, path); });\r\n                }\r\n                else if ('object' === typeof context) {\r\n                    if (null == path && 'string' === typeof actualContext) {\r\n                        path = actualContext;\r\n                        actualContext = rootContext;\r\n                    }\r\n                    var targetContext_1 = path ? (deepGet(actualContext, path) || {}) : actualContext;\r\n                    Object.entries(context).map(function (_a) {\r\n                        var k = _a[0], v = _a[1];\r\n                        return targetContext_1[k] = v;\r\n                    });\r\n                    if (path) {\r\n                        deepSet(actualContext, path, targetContext_1);\r\n                    }\r\n                }\r\n            }\r\n            scheduleRender();\r\n        }\r\n        function eventProxy(event) {\r\n            var element = event.currentTarget;\r\n            var props = elementProps.get(element);\r\n            var context = deepGet(props, CONTEXT);\r\n            var extra = deepGet(props, EXTRA);\r\n            var newContext = props[\"on\" + event.type](event, context, extra);\r\n            mutate(newContext, context);\r\n        }\r\n        function render() {\r\n            var root = resolveNode(x(view, rootProps, glueNode[CHILDREN]))[0];\r\n            var node = mergeGlueNode(root, glueNode);\r\n            var patchStacks = [\r\n                patch( /* mutate */),\r\n                pickLifecycleEvents(mutate)\r\n            ];\r\n            var patchStack = patchStacks.map(function (v) { return v[0]; }).reduce(function (acc, stack) { return stack(acc); }, function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                return patchStack.apply(null, args);\r\n            });\r\n            glueNode = patchStack(node, 'svg' === node.name, eventProxy, elementProps, false);\r\n            patchStacks.map(function (v) { return v[1] && v[1](); });\r\n        }\r\n        function rendered() {\r\n            scheduled = false;\r\n        }\r\n        function renderedError(e) {\r\n            rendered();\r\n            throw e;\r\n        }\r\n        function scheduleRender() {\r\n            if (!scheduled) {\r\n                scheduled = true;\r\n                Promise.resolve().then(render).then(rendered, renderedError);\r\n            }\r\n        }\r\n        return mutate;\r\n    }\n\n    exports.atto = atto;\n    exports.x = x;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n"]}
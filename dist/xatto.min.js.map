{"version":3,"sources":["dist/xatto.js"],"names":["global","factory","exports","module","define","amd","xatto","this","ATTRIBUTES","CHILDREN","KEY","NAME","CONTEXT","EXTRA","SLICE","TEXT","XA_CONTEXT","XA_EXTRA","XA_SLICE","deepGet","target","key","separator","idx","indexOf","slice","deepSet","value","current","nexts","next","split","parseInt","CREATE","DESTROY","REMOVE","REMOVING","UPDATE","ELEMENT","LIFECYCLE","PREV_ATTRIBUTES","PREV","TEXT_NODE","XLINK_NS","updateAttribute","element","name","oldValue","isSVG","eventProxy","events","removeEventListener","addEventListener","nullOrFalse","removeAttribute","ns","originName","replace","setAttribute","setAttributeNS","removeAttributeNS","patch","patchStack","glueNode","isDestroy","children","reduce","acc","childNode","patchedChild","concat","node","attributes","document","createTextNode","createElementNS","createElement","name_1","context","extra","nodeValue","prevAttributes","updateElement","parentElement","removeChild","map","v","reduceRight","ref","elm","insertBefore","lifeCycleEventPath","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","isVNode","keys","createVNode","mayBeTextNode","x","rest","_i","pop","Array","isArray","unshift","atto","view","elementOrGlueNode","scheduled","Element","nodeName","rootContext","mutate","actualContext","path","Promise","then","newContext","targetContext_1","entries","_a","k","resolve","render","rendered","renderedError","event","currentTarget","type","lifecycleEvents","mergeGlueNode","vNode","newGlueNode","child","indexedPrevChildren","prevChild","_prevChild","splice","_","index","push","resolveNode","parentNode","sliced","defaultValue","resolved","reslvedChild","stack","lifecycleEvent","lifecycle","onremove_1","done_1","attrs","prevAttrs","args","apply","e"],"mappings":"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","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (factory((global.xatto = {})));\n}(this, (function (exports) { 'use strict';\n\n  var ATTRIBUTES = 'attributes';\r\n  var CHILDREN = 'children';\r\n  var KEY = 'key';\r\n  var NAME = 'name';\n\n  var CONTEXT = 'xa.context';\r\n  var EXTRA = 'xa.extra';\r\n  var SLICE = 'xa.slice';\r\n  var TEXT = 'xa.text';\r\n  /*\r\n   * Attributes to be deprecated in v1\r\n   */\r\n  var XA_CONTEXT = 'xa-context';\r\n  var XA_EXTRA = 'xa-extra';\r\n  var XA_SLICE = 'xa-slice';\n\n  /**\r\n   * Get an item from an object using separator notation.\r\n   *\r\n   * @typeparam {T}\r\n   * @param {any} target\r\n   * @param {string} key\r\n   * @param {string} separator\r\n   * @return {T}\r\n   */\r\n  function deepGet(target, key, separator) {\r\n      if (separator === void 0) { separator = '.'; }\r\n      while (true) {\r\n          if (target == null) {\r\n              return target;\r\n          }\r\n          var idx = key.indexOf(separator);\r\n          if (idx < 0) {\r\n              return target[key];\r\n          }\r\n          target = target[key.slice(0, idx)];\r\n          key = key.slice(idx + 1);\r\n      }\r\n  }\n\n  /**\r\n   * Set an object item to a given value using separator notation.\r\n   *\r\n   * @param {any} target\r\n   * @param {string} key\r\n   * @param {any} value\r\n   * @param {string} separator\r\n   * @return {boolean}\r\n   */\r\n  function deepSet(target, key, value, separator) {\r\n      if (separator === void 0) { separator = '.'; }\r\n      while (true) {\r\n          if ('object' !== typeof target) {\r\n              return false;\r\n          }\r\n          var idx = key.indexOf(separator);\r\n          if (idx < 0) {\r\n              target[key] = value;\r\n              return true;\r\n          }\r\n          var current = key.slice(0, idx);\r\n          var nexts = key.slice(idx + 1);\r\n          if (null == target[current]) {\r\n              var next = nexts.split(separator, 1)[0];\r\n              target[current] = next === \"\" + parseInt(next, 10) ? [] : {};\r\n          }\r\n          target = target[current];\r\n          key = nexts;\r\n      }\r\n  }\n\n  var CREATE = 'create';\r\n  var DESTROY = 'destroy';\r\n  var REMOVE = 'remove';\r\n  var REMOVING = 'removing';\r\n  var UPDATE = 'update';\n\n  var ELEMENT = 'element';\r\n  var LIFECYCLE = 'lifecycle';\r\n  var PREV = 'prev';\r\n  var PREV_ATTRIBUTES = PREV + \".\" + ATTRIBUTES;\n\n  var TEXT_NODE = 'xa-txt';\n\n  var XLINK_NS = \"http://www.w3.org/1999/xlink\";\n\n  function updateAttribute(element, name, value, oldValue, isSVG, eventProxy) {\r\n      if (name === \"key\" || 'object' === typeof value) {\r\n          // noop\r\n      }\r\n      else {\r\n          if (name[0] === \"o\" && name[1] === \"n\") {\r\n              if (!element.events) {\r\n                  element.events = {};\r\n              }\r\n              element.events[(name = name.slice(2))] = value;\r\n              if (value == null) {\r\n                  element.removeEventListener(name, eventProxy);\r\n              }\r\n              else if (oldValue == null) {\r\n                  element.addEventListener(name, eventProxy);\r\n              }\r\n          }\r\n          else {\r\n              var nullOrFalse = value == null || value === false;\r\n              if (name in element &&\r\n                  name !== \"list\" &&\r\n                  name !== \"draggable\" &&\r\n                  name !== \"spellcheck\" &&\r\n                  name !== \"translate\" &&\r\n                  !isSVG) {\r\n                  if (nullOrFalse) {\r\n                      element.removeAttribute(name);\r\n                  }\r\n                  else {\r\n                      element[name] = value == null ? \"\" : value;\r\n                  }\r\n              }\r\n              else {\r\n                  var ns = false;\r\n                  if (isSVG) {\r\n                      var originName = name;\r\n                      name = name.replace(/^xlink:?/, \"\");\r\n                      ns = name !== originName;\r\n                  }\r\n                  switch ((nullOrFalse ? 1 : 0) + ((ns ? 1 : 0) << 1)) {\r\n                      case 0:\r\n                          element.setAttribute(name, value);\r\n                          break;\r\n                      case 1:\r\n                          element.removeAttribute(name);\r\n                          break;\r\n                      case 2:\r\n                          element.setAttributeNS(XLINK_NS, name, value);\r\n                          break;\r\n                      case 3:\r\n                          element.removeAttributeNS(XLINK_NS, name);\r\n                  }\r\n              }\r\n          }\r\n      }\r\n  }\n\n  function createElement(node, isSVG, eventProxy) {\r\n      var attributes = node[ATTRIBUTES] || {};\r\n      if (node[NAME] === TEXT_NODE) {\r\n          return document.createTextNode(deepGet(attributes, TEXT));\r\n      }\r\n      var element = (isSVG = isSVG || node[NAME] === \"svg\")\r\n          ? document.createElementNS(\"http://www.w3.org/2000/svg\", node[NAME])\r\n          : document.createElement(node[NAME]);\r\n      for (var name_1 in attributes) {\r\n          updateAttribute(element, name_1, attributes[name_1], null, isSVG, eventProxy);\r\n      }\r\n      element.context = deepGet(attributes, CONTEXT) || attributes[CONTEXT] || {}; // todo mixed to be deprecated\r\n      element.extra = deepGet(attributes, EXTRA) || attributes[EXTRA] || {}; // todo mixed to be deprecated\r\n      return element;\r\n  }\n\n  function updateElement(node, isSVG, eventProxy) {\r\n      var element = node[ELEMENT];\r\n      var attributes = node[ATTRIBUTES];\r\n      if (node[NAME] === TEXT_NODE) {\r\n          element.nodeValue = deepGet(attributes, TEXT);\r\n          return element;\r\n      }\r\n      var prevAttributes = deepGet(node, PREV_ATTRIBUTES) || {};\r\n      for (var name_1 in attributes) {\r\n          if (attributes[name_1] !==\r\n              (name_1 === \"value\" || name_1 === \"checked\"\r\n                  ? element[name_1]\r\n                  : prevAttributes[name_1])) {\r\n              updateAttribute(element, name_1, attributes[name_1], prevAttributes[name_1], isSVG, eventProxy);\r\n          }\r\n      }\r\n      element.context = deepGet(attributes, CONTEXT) || attributes[XA_CONTEXT] || {}; // todo mixed to be deprecated\r\n      element.extra = deepGet(attributes, EXTRA) || attributes[XA_EXTRA] || {}; // todo mixed to be deprecated\r\n      return element;\r\n  }\n\n  function patch(patchStack) {\r\n      return function (glueNode, isSVG, eventProxy, isDestroy) {\r\n          var element;\r\n          if (!isSVG && glueNode[NAME] === 'svg') {\r\n              isSVG = true;\r\n          }\r\n          if (!isDestroy && glueNode[LIFECYCLE] === DESTROY) {\r\n              isDestroy = true;\r\n          }\r\n          var children = glueNode[CHILDREN].reduce(function (acc, childNode) {\r\n              var patchedChild = patchStack(childNode, isSVG, eventProxy, isDestroy);\r\n              return patchedChild ? acc.concat(patchedChild) : acc;\r\n          }, []);\r\n          var lifecycle = isDestroy ? DESTROY : glueNode[LIFECYCLE];\r\n          switch (lifecycle) {\r\n              case CREATE:\r\n                  element = createElement(glueNode, isSVG, eventProxy);\r\n                  break;\r\n              case UPDATE:\r\n                  element = updateElement(glueNode, isSVG, eventProxy);\r\n                  break;\r\n              case DESTROY:\r\n                  if (glueNode[LIFECYCLE] === DESTROY) {\r\n                      element = glueNode[ELEMENT];\r\n                      element.parentElement.removeChild(element);\r\n                  }\r\n                  return null;\r\n              case REMOVE:\r\n                  glueNode[LIFECYCLE] = REMOVING;\r\n              default:\r\n                  element = glueNode[ELEMENT];\r\n          }\r\n          children.map(function (v) { return v.element; }).reduceRight(function (ref, elm) {\r\n              element.insertBefore(elm, ref);\r\n              return elm;\r\n          }, null);\r\n          glueNode[CHILDREN] = children;\r\n          glueNode[ELEMENT] = element;\r\n          return glueNode;\r\n      };\r\n  }\n\n  var lifeCycleEventPath = function (name) { return ATTRIBUTES + \".on\" + name; };\n\n  function pickLifecycleEvents(lifecycleEvents, mutate) {\r\n      return function (stack) { return function (glueNode, isSVG, eventProxy, isDestroy) {\r\n          if (isDestroy === void 0) { isDestroy = false; }\r\n          var lifecycle = isDestroy ? DESTROY : glueNode[LIFECYCLE];\r\n          glueNode = stack(glueNode, isSVG, eventProxy, isDestroy);\r\n          var lifecycleEvent;\r\n          switch (lifecycle) {\r\n              case CREATE:\r\n                  lifecycleEvent = deepGet(glueNode, lifeCycleEventPath(CREATE));\r\n                  break;\r\n              case UPDATE:\r\n                  lifecycleEvent = deepGet(glueNode, lifeCycleEventPath(UPDATE));\r\n                  break;\r\n              case REMOVE:\r\n                  var onremove_1 = deepGet(glueNode, lifeCycleEventPath(REMOVE));\r\n                  var done_1 = function () {\r\n                      glueNode[LIFECYCLE] = DESTROY;\r\n                      Promise.resolve().then(mutate);\r\n                  };\r\n                  lifecycleEvent = function (element, attrs, prevAttrs) {\r\n                      onremove_1(element, done_1, attrs, prevAttrs);\r\n                  };\r\n                  break;\r\n              case DESTROY:\r\n                  lifecycleEvent = deepGet(glueNode, lifeCycleEventPath(DESTROY));\r\n                  break;\r\n          }\r\n          if (lifecycleEvent) {\r\n              lifecycleEvents.push(function () {\r\n                  lifecycleEvent(glueNode[ELEMENT], glueNode[ATTRIBUTES], deepGet(glueNode, PREV_ATTRIBUTES));\r\n              });\r\n          }\r\n          return glueNode;\r\n      }; };\r\n  }\n\n  /*! *****************************************************************************\r\n  Copyright (c) Microsoft Corporation. All rights reserved.\r\n  Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\n  this file except in compliance with the License. You may obtain a copy of the\r\n  License at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\n  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\n  MERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\n  See the Apache Version 2.0 License for specific language governing permissions\r\n  and limitations under the License.\r\n  ***************************************************************************** */\r\n\r\n  var __assign = Object.assign || function __assign(t) {\r\n      for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n          s = arguments[i];\r\n          for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n      }\r\n      return t;\r\n  };\n\n  function isVNode(value) {\r\n      return null != value\r\n          && 'object' === typeof value\r\n          && ATTRIBUTES in value\r\n          && CHILDREN in value\r\n          && KEY in value\r\n          && NAME in value\r\n          && 4 === Object.keys(value).length;\r\n  }\n\n  function resolveNode(node, parentNode) {\r\n      var attributes = node && node[ATTRIBUTES];\r\n      if (attributes) {\r\n          var context = deepGet(attributes, CONTEXT)\r\n              || attributes[XA_CONTEXT]\r\n              || (parentNode && (deepGet(parentNode, ATTRIBUTES + \".\" + CONTEXT)\r\n                  || deepGet(parentNode, ATTRIBUTES + \".\" + XA_CONTEXT)))\r\n              || {}; // todo mixed to be deprecated\r\n          var slice = deepGet(attributes, SLICE) || attributes[XA_SLICE]; // todo mixed to be deprecated\r\n          var sliced = void 0;\r\n          if ('object' !== typeof slice) {\r\n              slice = [slice];\r\n          }\r\n          var path = slice[0];\r\n          if (path) {\r\n              sliced = deepGet(context, path);\r\n              if (!sliced) {\r\n                  var defaultValue = slice[1] || {};\r\n                  sliced = __assign({}, defaultValue);\r\n                  deepSet(context, path, sliced);\r\n              }\r\n              context = sliced;\r\n          }\r\n          var extra = __assign({}, (deepGet(attributes, EXTRA) || attributes[XA_EXTRA] || {}), (parentNode && (deepGet(parentNode, ATTRIBUTES + \".\" + EXTRA)\r\n              || deepGet(parentNode, ATTRIBUTES + \".\" + XA_EXTRA)) || {}));\r\n          deepSet(attributes, CONTEXT, context);\r\n          deepSet(attributes, EXTRA, extra);\r\n          deepSet(attributes, SLICE, []);\r\n          attributes[XA_CONTEXT] = context; // todo to be deprecated\r\n          attributes[XA_EXTRA] = extra; // todo to be deprecated\r\n      }\r\n      var resolved = (node && typeof node.name === \"function\")\r\n          ? resolveNode(node.name(node[ATTRIBUTES], node[CHILDREN]), node)\r\n          : node;\r\n      if (isVNode(resolved)) {\r\n          resolved[CHILDREN] = resolved[CHILDREN].reduce(function (acc, child) {\r\n              var reslvedChild = resolveNode(child, resolved);\r\n              if (reslvedChild) {\r\n                  acc.push(reslvedChild);\r\n              }\r\n              return acc;\r\n          }, []);\r\n          return resolved;\r\n      }\r\n      return null;\r\n  }\n\n  function mergeGlueNode(vNode, glueNode) {\r\n      var newGlueNode;\r\n      if (!glueNode) {\r\n          newGlueNode = __assign({}, vNode);\r\n          newGlueNode[LIFECYCLE] = CREATE;\r\n          newGlueNode[CHILDREN] = vNode[CHILDREN].map(function (child) { return mergeGlueNode(child, null); });\r\n          deepSet(newGlueNode, PREV_ATTRIBUTES, {});\r\n          return newGlueNode;\r\n      }\r\n      if (!vNode) {\r\n          deepSet(glueNode, PREV_ATTRIBUTES, glueNode[ATTRIBUTES]);\r\n          glueNode[LIFECYCLE] = (glueNode[LIFECYCLE] === REMOVING || glueNode[LIFECYCLE] === DESTROY)\r\n              ? glueNode[LIFECYCLE]\r\n              : (deepGet(glueNode, lifeCycleEventPath(REMOVE))\r\n                  ? REMOVE\r\n                  : DESTROY);\r\n          return glueNode;\r\n      }\r\n      deepSet(glueNode, PREV_ATTRIBUTES, glueNode[ATTRIBUTES]);\r\n      glueNode[ATTRIBUTES] = vNode[ATTRIBUTES];\r\n      glueNode[KEY] = vNode[KEY];\r\n      glueNode[NAME] = vNode[NAME];\r\n      glueNode[LIFECYCLE] = UPDATE;\r\n      var indexedPrevChildren = glueNode[CHILDREN].map(function (child, i) { return (child.i = i, child); });\r\n      var children = vNode[CHILDREN].map(function (child) {\r\n          var prevChild, _prevChild, i;\r\n          for (i = 0; i < indexedPrevChildren.length; i++) {\r\n              _prevChild = indexedPrevChildren[i];\r\n              if (child[NAME] == _prevChild[NAME]\r\n                  && child[KEY] == _prevChild[KEY]\r\n                  && (UPDATE === _prevChild[LIFECYCLE] || CREATE === _prevChild[LIFECYCLE])) {\r\n                  prevChild = _prevChild;\r\n                  break;\r\n              }\r\n          }\r\n          if (prevChild) {\r\n              indexedPrevChildren.splice(i, 1);\r\n              return mergeGlueNode(child, prevChild);\r\n          }\r\n          else {\r\n              return mergeGlueNode(child, null);\r\n          }\r\n      });\r\n      indexedPrevChildren.reduceRight(function (_, child) {\r\n          child = mergeGlueNode(null, child);\r\n          if (0 === child.i) {\r\n              children.unshift(child);\r\n          }\r\n          else {\r\n              var index = child.i - 1;\r\n              var i = void 0;\r\n              for (i = 0; i < children.length; i++) {\r\n                  if (index === children[i].i) {\r\n                      children.splice(i + 1, 0, child);\r\n                      return;\r\n                  }\r\n              }\r\n              children.push(child);\r\n          }\r\n      }, 0);\r\n      glueNode[CHILDREN] = children;\r\n      return glueNode;\r\n  }\n\n  function createVNode(mayBeTextNode, name, attributes, children) {\r\n      if (attributes === void 0) { attributes = {}; }\r\n      if (children === void 0) { children = []; }\r\n      var node = {};\r\n      node[NAME] = name;\r\n      node[ATTRIBUTES] = attributes;\r\n      node[CHILDREN] = children;\r\n      node[KEY] = attributes.key;\r\n      if (mayBeTextNode && 'function' !== typeof name) {\r\n          node[NAME] = TEXT_NODE;\r\n          deepSet(node[ATTRIBUTES], TEXT, name);\r\n      }\r\n      return node;\r\n  }\n\n  function x(name, attributes) {\r\n      var rest = [];\r\n      for (var _i = 2; _i < arguments.length; _i++) {\r\n          rest[_i - 2] = arguments[_i];\r\n      }\r\n      var children = [];\r\n      while (rest.length) {\r\n          var node = rest.pop();\r\n          if (node && Array.isArray(node)) {\r\n              rest = rest.concat(node);\r\n          }\r\n          else if (node != null && node !== true && node !== false) {\r\n              children.unshift(isVNode(node) && node || createVNode(true, node));\r\n          }\r\n      }\r\n      return createVNode(false, name, attributes || {}, children);\r\n  }\n\n  function atto(view, elementOrGlueNode) {\r\n      var scheduled = false;\r\n      var glueNode = elementOrGlueNode instanceof Element\r\n          ? {\r\n              name: elementOrGlueNode.nodeName,\r\n              attributes: {},\r\n              children: [],\r\n              element: elementOrGlueNode\r\n          }\r\n          : elementOrGlueNode;\r\n      var attributes = glueNode[ATTRIBUTES];\r\n      var rootContext = deepGet(attributes, CONTEXT) || attributes[XA_CONTEXT] || {}; // todo mixed to be deprecated\r\n      deepSet(attributes, CONTEXT, rootContext);\r\n      attributes[XA_CONTEXT] = rootContext; // todo to be deprecated\r\n      function mutate(context, actualContext, path) {\r\n          if (context === void 0) { context = null; }\r\n          if (actualContext === void 0) { actualContext = rootContext; }\r\n          if (path === void 0) { path = null; }\r\n          if (context && context !== actualContext) {\r\n              if ('function' === typeof context) {\r\n                  return context(mutate, actualContext, rootContext);\r\n              }\r\n              else if (context instanceof Promise) {\r\n                  return context.then(function (newContext) { return mutate(newContext, actualContext, path); });\r\n              }\r\n              else if ('object' === typeof context) {\r\n                  if (null == path && 'string' === typeof actualContext) {\r\n                      path = actualContext;\r\n                      actualContext = rootContext;\r\n                  }\r\n                  var targetContext_1 = path ? (deepGet(actualContext, path) || {}) : actualContext;\r\n                  Object.entries(context).map(function (_a) {\r\n                      var k = _a[0], v = _a[1];\r\n                      return targetContext_1[k] = v;\r\n                  });\r\n                  if (path) {\r\n                      deepSet(actualContext, path, targetContext_1);\r\n                  }\r\n              }\r\n          }\r\n          scheduleRender();\r\n      }\r\n      function eventProxy(event) {\r\n          var element = event.currentTarget;\r\n          element.context = element.context || {};\r\n          element.extra = element.extra || {};\r\n          var context = element.events[event.type](event, element.context, element.extra);\r\n          mutate(context, element.context);\r\n      }\r\n      function render() {\r\n          var lifecycleEvents = [];\r\n          var node = mergeGlueNode(resolveNode(x(view, attributes, glueNode && glueNode[CHILDREN]), x('div', {}, [])), glueNode);\r\n          var patchStack = [\r\n              pickLifecycleEvents(lifecycleEvents, mutate)\r\n          ].reduce(function (acc, stack) { return stack(acc); }, patch(function () {\r\n              var args = [];\r\n              for (var _i = 0; _i < arguments.length; _i++) {\r\n                  args[_i] = arguments[_i];\r\n              }\r\n              return patchStack.apply(null, args);\r\n          }));\r\n          glueNode = patchStack(node, 'svg' === node.name, eventProxy, false);\r\n          lifecycleEvents.reduce(function (_, lifecycleEvent) { return lifecycleEvent(); }, 0);\r\n      }\r\n      function rendered() {\r\n          scheduled = false;\r\n      }\r\n      function renderedError(e) {\r\n          rendered();\r\n          throw e;\r\n      }\r\n      function scheduleRender() {\r\n          if (!scheduled) {\r\n              scheduled = true;\r\n              Promise.resolve().then(render).then(rendered, renderedError);\r\n          }\r\n      }\r\n      return mutate;\r\n  }\n\n  exports.atto = atto;\n  exports.x = x;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n"]}
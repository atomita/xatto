{"version":3,"sources":["dist/xatto.js"],"names":["global","factory","exports","module","define","amd","xatto","this","CHILDREN","KEY","NAME","PROPS","CONTEXT","EXTRA","SLICE","TEXT","ELEMENT","LIFECYCLE","PREV_PROPS","PREV","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","CREATE","DESTROY","REMOVE","REMOVING","UPDATE","deepSet","target","key","value","separator","idx","indexOf","current","slice","nexts","next","split","parseInt","createGlueNode","vNode","newGlueNode","map","child","TEXT_NODE","createVNode","mayBeTextNode","name","props","children","node","deepGet","lifeCycleEventPath","XLINK_NS","updateAttribute","element","oldValue","isSVG","eventProxy","elementProps","eventName","removeEventListener","addEventListener","nullOrFalse","removeAttribute","ns","originName","replace","setAttribute","setAttributeNS","removeAttributeNS","patch","patchStack","glueNode","isDestroy","reduce","acc","childNode","patchedChild","concat","document","createTextNode","createElementNS","createElement","name_1","set","nodeValue","prevAttributes","updateElement","parentElement","removeChild","v","reduceRight","ref","elm","insertBefore","remodelProps","context","extra","isVNode","keys","resolveNode","parentNode","sliced","rawProps","path","defaultValue","resolved","reslvedChild","push","x","rest","_i","pop","Array","isArray","unshift","atto","view","elementOrGlueNode","scheduled","Element","nodeName","rootProps","rootContext","WeakMap","mutate","actualContext","Promise","then","newContext","targetContext_1","entries","_a","k","resolve","render","rendered","renderedError","event","currentTarget","get","type","lifecycleEvents","mergeGlueNode","indexedPrevChildren","prevChild","_prevChild","splice","_","undefined","index","stack","lifecycleEvent","lifecycle","onremove_1","done_1","attrs","prevAttrs","args","apply","e"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n    typeof define === 'function' && define.amd ? define(['exports'], factory) :\n    (factory((global.xatto = {})));\n}(this, (function (exports) { 'use strict';\n\n    var CHILDREN = 'children';\r\n    var KEY = 'key';\r\n    var NAME = 'name';\r\n    var PROPS = 'props';\n\n    var CONTEXT = 'xa.context';\r\n    var EXTRA = 'xa.extra';\r\n    var SLICE = 'xa.slice';\r\n    var TEXT = 'xa.text';\n\n    var ELEMENT = 'element';\r\n    var LIFECYCLE = 'lifecycle';\r\n    var PREV = 'prev';\r\n    var PREV_PROPS = PREV + \".\" + PROPS;\n\n    /*! *****************************************************************************\r\n    Copyright (c) Microsoft Corporation. All rights reserved.\r\n    Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\n    this file except in compliance with the License. You may obtain a copy of the\r\n    License at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\n    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\n    MERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\n    See the Apache Version 2.0 License for specific language governing permissions\r\n    and limitations under the License.\r\n    ***************************************************************************** */\r\n\r\n    var __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\n\n    var CREATE = 'create';\r\n    var DESTROY = 'destroy';\r\n    var REMOVE = 'remove';\r\n    var REMOVING = 'removing';\r\n    var UPDATE = 'update';\n\n    /**\r\n     * Set an object item to a given value using separator notation.\r\n     *\r\n     * @param {any} target\r\n     * @param {string} key\r\n     * @param {any} value\r\n     * @param {string} separator\r\n     * @return {boolean}\r\n     */\r\n    function deepSet(target, key, value, separator) {\r\n        if (separator === void 0) { separator = '.'; }\r\n        while (true) {\r\n            if ('object' !== typeof target) {\r\n                return false;\r\n            }\r\n            var idx = key.indexOf(separator);\r\n            if (idx < 0) {\r\n                target[key] = value;\r\n                return true;\r\n            }\r\n            var current = key.slice(0, idx);\r\n            var nexts = key.slice(idx + 1);\r\n            if (null == target[current]) {\r\n                var next = nexts.split(separator, 1)[0];\r\n                target[current] = next === \"\" + parseInt(next, 10) ? [] : {};\r\n            }\r\n            target = target[current];\r\n            key = nexts;\r\n        }\r\n    }\n\n    function createGlueNode(vNode) {\r\n        var newGlueNode = __assign({}, vNode);\r\n        newGlueNode.i = 0;\r\n        newGlueNode[LIFECYCLE] = CREATE;\r\n        newGlueNode[CHILDREN] = vNode[CHILDREN].map(function (child) { return createGlueNode(child); });\r\n        deepSet(newGlueNode, PREV_PROPS, {});\r\n        return newGlueNode;\r\n    }\n\n    var TEXT_NODE = 'xa-txt';\n\n    function createVNode(mayBeTextNode, name, props, children) {\r\n        if (props === void 0) { props = {}; }\r\n        if (children === void 0) { children = []; }\r\n        var node = {};\r\n        node[NAME] = name;\r\n        node[PROPS] = props;\r\n        node[CHILDREN] = children;\r\n        node[KEY] = props.key;\r\n        if (mayBeTextNode && 'function' !== typeof name) {\r\n            node[NAME] = TEXT_NODE;\r\n            deepSet(node[PROPS], TEXT, name);\r\n        }\r\n        return node;\r\n    }\n\n    function createGlueNodeByElement(element) {\r\n        var node = createGlueNode(createVNode(false, element.nodeName));\r\n        node[ELEMENT] = element;\r\n        return node;\r\n    }\n\n    /**\r\n     * Get an item from an object using separator notation.\r\n     *\r\n     * @typeparam {T}\r\n     * @param {any} target\r\n     * @param {string} key\r\n     * @param {string} separator\r\n     * @return {T}\r\n     */\r\n    function deepGet(target, key, separator) {\r\n        if (separator === void 0) { separator = '.'; }\r\n        while (true) {\r\n            if (target == null) {\r\n                return target;\r\n            }\r\n            var idx = key.indexOf(separator);\r\n            if (idx < 0) {\r\n                return target[key];\r\n            }\r\n            target = target[key.slice(0, idx)];\r\n            key = key.slice(idx + 1);\r\n        }\r\n    }\n\n    var lifeCycleEventPath = function (name) { return PROPS + \".on\" + name; };\n\n    function mergeGlueNode(vNode, glueNode) {\r\n        if (!glueNode) {\r\n            return createGlueNode(vNode);\r\n        }\r\n        if (!vNode) {\r\n            deepSet(glueNode, PREV_PROPS, glueNode[PROPS]);\r\n            glueNode[LIFECYCLE] = (glueNode[LIFECYCLE] === REMOVING || glueNode[LIFECYCLE] === DESTROY)\r\n                ? glueNode[LIFECYCLE]\r\n                : (deepGet(glueNode, lifeCycleEventPath(REMOVE))\r\n                    ? REMOVE\r\n                    : DESTROY);\r\n            return glueNode;\r\n        }\r\n        deepSet(glueNode, PREV_PROPS, glueNode[PROPS]);\r\n        glueNode[PROPS] = vNode[PROPS];\r\n        glueNode[KEY] = vNode[KEY];\r\n        glueNode[NAME] = vNode[NAME];\r\n        glueNode[LIFECYCLE] = UPDATE;\r\n        var indexedPrevChildren = glueNode[CHILDREN].map(function (child, i) { return (child.i = i, child); });\r\n        var children = vNode[CHILDREN].map(function (child) {\r\n            var prevChild, _prevChild, i;\r\n            for (i = 0; i < indexedPrevChildren.length; i++) {\r\n                _prevChild = indexedPrevChildren[i];\r\n                if (child[NAME] == _prevChild[NAME]\r\n                    && child[KEY] == _prevChild[KEY]\r\n                    && (UPDATE === _prevChild[LIFECYCLE] || CREATE === _prevChild[LIFECYCLE])) {\r\n                    prevChild = _prevChild;\r\n                    break;\r\n                }\r\n            }\r\n            if (prevChild) {\r\n                indexedPrevChildren.splice(i, 1);\r\n                return mergeGlueNode(child, prevChild);\r\n            }\r\n            else {\r\n                return mergeGlueNode(child);\r\n            }\r\n        });\r\n        indexedPrevChildren.reduceRight(function (_, child) {\r\n            child = mergeGlueNode(undefined, child);\r\n            if (0 === child.i) {\r\n                children.unshift(child);\r\n            }\r\n            else {\r\n                var index = child.i - 1;\r\n                var i = void 0;\r\n                for (i = 0; i < children.length; i++) {\r\n                    if (index === children[i].i) {\r\n                        children.splice(i + 1, 0, child);\r\n                        return 0;\r\n                    }\r\n                }\r\n                children.push(child);\r\n            }\r\n            return 0;\r\n        }, 0);\r\n        glueNode[CHILDREN] = children;\r\n        return glueNode;\r\n    }\n\n    var XLINK_NS = \"http://www.w3.org/1999/xlink\";\n\n    function updateAttribute(element, name, value, oldValue, isSVG, eventProxy, elementProps) {\r\n        if (name === \"key\" || 'object' === typeof value) {\r\n            // noop\r\n        }\r\n        else {\r\n            if (name[0] === \"o\" && name[1] === \"n\") {\r\n                var eventName = name.slice(2);\r\n                if (value == null) {\r\n                    element.removeEventListener(eventName, eventProxy);\r\n                }\r\n                else if (oldValue == null) {\r\n                    element.addEventListener(eventName, eventProxy);\r\n                }\r\n            }\r\n            else {\r\n                var nullOrFalse = value == null || value === false;\r\n                if (name in element &&\r\n                    name !== \"list\" &&\r\n                    name !== \"draggable\" &&\r\n                    name !== \"spellcheck\" &&\r\n                    name !== \"translate\" &&\r\n                    !isSVG) {\r\n                    if (nullOrFalse) {\r\n                        element.removeAttribute(name);\r\n                    }\r\n                    else {\r\n                        element[name] = value == null ? \"\" : value;\r\n                    }\r\n                }\r\n                else {\r\n                    var ns = false;\r\n                    if (isSVG) {\r\n                        var originName = name;\r\n                        name = name.replace(/^xlink:?/, \"\");\r\n                        ns = name !== originName;\r\n                    }\r\n                    switch ((nullOrFalse ? 1 : 0) + ((ns ? 1 : 0) << 1)) {\r\n                        case 0:\r\n                            element.setAttribute(name, value);\r\n                            break;\r\n                        case 1:\r\n                            element.removeAttribute(name);\r\n                            break;\r\n                        case 2:\r\n                            element.setAttributeNS(XLINK_NS, name, value);\r\n                            break;\r\n                        case 3:\r\n                            element.removeAttributeNS(XLINK_NS, name);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\n\n    function createElement(node, isSVG, eventProxy, elementProps) {\r\n        var props = node[PROPS] || {};\r\n        if (node[NAME] === TEXT_NODE) {\r\n            return document.createTextNode(deepGet(props, TEXT));\r\n        }\r\n        var element = (isSVG = isSVG || node[NAME] === \"svg\")\r\n            ? document.createElementNS(\"http://www.w3.org/2000/svg\", node[NAME])\r\n            : document.createElement(node[NAME]);\r\n        for (var name_1 in props) {\r\n            updateAttribute(element, name_1, props[name_1], null, isSVG, eventProxy, elementProps);\r\n        }\r\n        elementProps.set(element, props);\r\n        return element;\r\n    }\n\n    function updateElement(node, isSVG, eventProxy, elementProps) {\r\n        var element = node[ELEMENT];\r\n        var props = node[PROPS];\r\n        if (node[NAME] === TEXT_NODE) {\r\n            element.nodeValue = deepGet(props, TEXT);\r\n            return element;\r\n        }\r\n        var prevAttributes = deepGet(node, PREV_PROPS) || {};\r\n        for (var name_1 in props) {\r\n            if (props[name_1] !==\r\n                (name_1 === \"value\" || name_1 === \"checked\"\r\n                    ? element[name_1]\r\n                    : prevAttributes[name_1])) {\r\n                updateAttribute(element, name_1, props[name_1], prevAttributes[name_1], isSVG, eventProxy, elementProps);\r\n            }\r\n        }\r\n        elementProps.set(element, props);\r\n        return element;\r\n    }\n\n    function patch(patchStack) {\r\n        return function (glueNode, isSVG, eventProxy, elementProps, isDestroy) {\r\n            var element;\r\n            if (!isSVG && glueNode[NAME] === 'svg') {\r\n                isSVG = true;\r\n            }\r\n            if (!isDestroy && glueNode[LIFECYCLE] === DESTROY) {\r\n                isDestroy = true;\r\n            }\r\n            var children = glueNode[CHILDREN].reduce(function (acc, childNode) {\r\n                var patchedChild = patchStack(childNode, isSVG, eventProxy, elementProps, isDestroy);\r\n                return patchedChild ? acc.concat(patchedChild) : acc;\r\n            }, []);\r\n            var lifecycle = isDestroy ? DESTROY : glueNode[LIFECYCLE];\r\n            switch (lifecycle) {\r\n                case CREATE:\r\n                    element = createElement(glueNode, isSVG, eventProxy, elementProps);\r\n                    break;\r\n                case UPDATE:\r\n                    element = updateElement(glueNode, isSVG, eventProxy, elementProps);\r\n                    break;\r\n                case DESTROY:\r\n                    if (glueNode[LIFECYCLE] === DESTROY) {\r\n                        element = glueNode[ELEMENT];\r\n                        element.parentElement.removeChild(element);\r\n                    }\r\n                    return null;\r\n                case REMOVE:\r\n                    glueNode[LIFECYCLE] = REMOVING;\r\n                default:\r\n                    element = glueNode[ELEMENT];\r\n            }\r\n            children.map(function (v) { return v.element; }).reduceRight(function (ref, elm) {\r\n                element.insertBefore(elm, ref);\r\n                return elm;\r\n            }, null);\r\n            glueNode[CHILDREN] = children;\r\n            glueNode[ELEMENT] = element;\r\n            return glueNode;\r\n        };\r\n    }\n\n    function pickLifecycleEvents(lifecycleEvents, mutate) {\r\n        return function (stack) { return function (glueNode, isSVG, eventProxy, elementProps, isDestroy) {\r\n            if (isDestroy === void 0) { isDestroy = false; }\r\n            var lifecycle = isDestroy ? DESTROY : glueNode[LIFECYCLE];\r\n            glueNode = stack(glueNode, isSVG, eventProxy, elementProps, isDestroy);\r\n            var lifecycleEvent;\r\n            switch (lifecycle) {\r\n                case CREATE:\r\n                    lifecycleEvent = deepGet(glueNode, lifeCycleEventPath(CREATE));\r\n                    break;\r\n                case UPDATE:\r\n                    lifecycleEvent = deepGet(glueNode, lifeCycleEventPath(UPDATE));\r\n                    break;\r\n                case REMOVE:\r\n                    var onremove_1 = deepGet(glueNode, lifeCycleEventPath(REMOVE));\r\n                    var done_1 = function () {\r\n                        glueNode[LIFECYCLE] = DESTROY;\r\n                        Promise.resolve().then(mutate);\r\n                    };\r\n                    lifecycleEvent = function (element, attrs, prevAttrs) {\r\n                        onremove_1(element, done_1, attrs, prevAttrs);\r\n                    };\r\n                    break;\r\n                case DESTROY:\r\n                    lifecycleEvent = deepGet(glueNode, lifeCycleEventPath(DESTROY));\r\n                    break;\r\n            }\r\n            if (lifecycleEvent) {\r\n                lifecycleEvents.push(function () {\r\n                    lifecycleEvent(glueNode[ELEMENT], glueNode[PROPS], deepGet(glueNode, PREV_PROPS));\r\n                });\r\n            }\r\n            return glueNode;\r\n        }; };\r\n    }\n\n    function remodelProps(props, context, extra, slice) {\r\n        deepSet(props, CONTEXT, context || deepGet(props, CONTEXT) || {});\r\n        deepSet(props, EXTRA, extra || deepGet(props, EXTRA) || {});\r\n        deepSet(props, SLICE, slice || deepGet(props, SLICE) || []);\r\n        return props;\r\n    }\n\n    function isVNode(value) {\r\n        return null != value\r\n            && 'object' === typeof value\r\n            && PROPS in value\r\n            && CHILDREN in value\r\n            && KEY in value\r\n            && NAME in value\r\n            && 4 === Object.keys(value).length;\r\n    }\n\n    function resolveNode(node, parentNode) {\r\n        var rawProps = node[PROPS];\r\n        var context = deepGet(rawProps, CONTEXT)\r\n            || (parentNode && deepGet(parentNode, PROPS + \".\" + CONTEXT))\r\n            || {};\r\n        var slice = deepGet(rawProps, SLICE);\r\n        var sliced;\r\n        if ('object' !== typeof slice) {\r\n            slice = [slice];\r\n        }\r\n        var path = slice[0];\r\n        if (path) {\r\n            sliced = deepGet(context, path);\r\n            if (!sliced) {\r\n                var defaultValue = slice[1] || {};\r\n                sliced = __assign({}, defaultValue);\r\n                deepSet(context, path, sliced);\r\n            }\r\n            context = sliced;\r\n        }\r\n        var extra = __assign({}, (deepGet(rawProps, EXTRA) || {}), (parentNode && deepGet(parentNode, PROPS + \".\" + EXTRA) || {}));\r\n        var props = remodelProps(rawProps, context, extra, []);\r\n        var resolved = (node && typeof node.name === \"function\")\r\n            ? resolveNode(node.name(props, node[CHILDREN]), node)\r\n            : node;\r\n        if (isVNode(resolved)) {\r\n            resolved[CHILDREN] = resolved[CHILDREN].reduce(function (acc, child) {\r\n                var reslvedChild = resolveNode(child, resolved);\r\n                if (reslvedChild) {\r\n                    acc.push(reslvedChild);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            return resolved;\r\n        }\r\n    }\n\n    function x(name, props) {\r\n        var rest = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            rest[_i - 2] = arguments[_i];\r\n        }\r\n        var children = [];\r\n        while (rest.length) {\r\n            var node = rest.pop();\r\n            if (node && Array.isArray(node)) {\r\n                rest = rest.concat(node);\r\n            }\r\n            else if (node != null && node !== true && node !== false) {\r\n                children.unshift(isVNode(node) && node || createVNode(true, node));\r\n            }\r\n        }\r\n        return createVNode(false, name, props || {}, children);\r\n    }\n\n    function atto(view, elementOrGlueNode) {\r\n        var scheduled = false;\r\n        var glueNode = elementOrGlueNode instanceof Element\r\n            ? createGlueNodeByElement(elementOrGlueNode)\r\n            : elementOrGlueNode;\r\n        var rootProps = remodelProps(glueNode[PROPS]);\r\n        var rootContext = deepGet(rootProps, CONTEXT);\r\n        var elementProps = new WeakMap();\r\n        function mutate(context, actualContext, path) {\r\n            if (context === void 0) { context = null; }\r\n            if (actualContext === void 0) { actualContext = rootContext; }\r\n            if (path === void 0) { path = null; }\r\n            if (context && context !== actualContext) {\r\n                if ('function' === typeof context) {\r\n                    return context(mutate, actualContext, rootContext);\r\n                }\r\n                else if (context instanceof Promise) {\r\n                    return context.then(function (newContext) { return mutate(newContext, actualContext, path); });\r\n                }\r\n                else if ('object' === typeof context) {\r\n                    if (null == path && 'string' === typeof actualContext) {\r\n                        path = actualContext;\r\n                        actualContext = rootContext;\r\n                    }\r\n                    var targetContext_1 = path ? (deepGet(actualContext, path) || {}) : actualContext;\r\n                    Object.entries(context).map(function (_a) {\r\n                        var k = _a[0], v = _a[1];\r\n                        return targetContext_1[k] = v;\r\n                    });\r\n                    if (path) {\r\n                        deepSet(actualContext, path, targetContext_1);\r\n                    }\r\n                }\r\n            }\r\n            scheduleRender();\r\n        }\r\n        function eventProxy(event) {\r\n            var element = event.currentTarget;\r\n            var props = elementProps.get(element);\r\n            var context = deepGet(props, CONTEXT);\r\n            var extra = deepGet(props, EXTRA);\r\n            var newContext = props[\"on\" + event.type](event, context, extra);\r\n            mutate(newContext, context);\r\n        }\r\n        function render() {\r\n            var lifecycleEvents = [];\r\n            var node = mergeGlueNode(resolveNode(x(view, rootProps, glueNode[CHILDREN])) || resolveNode(x('div', {}, [])), glueNode);\r\n            var patchStack = [\r\n                pickLifecycleEvents(lifecycleEvents, mutate)\r\n            ].reduce(function (acc, stack) { return stack(acc); }, patch(function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                return patchStack.apply(null, args);\r\n            }));\r\n            glueNode = patchStack(node, 'svg' === node.name, eventProxy, elementProps, false);\r\n            lifecycleEvents.reduce(function (_, lifecycleEvent) { return lifecycleEvent(); }, 0);\r\n        }\r\n        function rendered() {\r\n            scheduled = false;\r\n        }\r\n        function renderedError(e) {\r\n            rendered();\r\n            throw e;\r\n        }\r\n        function scheduleRender() {\r\n            if (!scheduled) {\r\n                scheduled = true;\r\n                Promise.resolve().then(render).then(rendered, renderedError);\r\n            }\r\n        }\r\n        return mutate;\r\n    }\n\n    exports.atto = atto;\n    exports.x = x;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n"]}
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.xatto={})}(this,function(o){"use strict";var b="xa.context",w="xa.extra",x="xa.fill",N="xa.path",S="xa.slice",y="xa.text",k="middlewares",E="children",c="key",g="name",j="props",O="node",A="lifecycle",P="prev."+j;function C(n,t){for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}var M="create",q="destroy",R="remove",T="update",W="function",F="object",t="string";function L(n,t,e,r){for(void 0===r&&(r=".");;){if(F!==typeof n)return!1;var u=t.indexOf(r);if(u<0)return n[t]=e,!0;var i=t.slice(0,u),o=t.slice(u+1);if(null==n[i]){var a=o.split(r,1)[0];n[i]=a===""+parseInt(a,10)?[]:{}}n=n[i],t=o}}function B(n,t,e){var r=C({},n);return r.i=0,r[A]=M,r[E]=n[E].map(function(n){return e(M,n)}),L(r,P,{}),r}var n,I="xa-txt";function V(n,t,e,r){void 0===e&&(e={}),void 0===r&&(r=[]);var u={};return u[g]=t,u[j]=e,u[E]=r,u[c]=e.key,n&&W!==typeof t&&(u[g]=I,L(u[j],y,t)),u}function z(){}function D(n,t,e){for(void 0===e&&(e=".");;){if(null==n)return n;var r=t.indexOf(e);if(r<0)return n[t];n=n[t.slice(0,r)],t=t.slice(r+1)}}function G(t,e,r,n,u){if(n){if(n instanceof Promise)return n.then(function(n){return G(t,e,r,n,u)});if(W===typeof n)return n(G,t);if(F===typeof n){var i=t(u);if(n===i)return;var o=C(C({},i),n);e(o,u),r()}}}function H(e,r,u,i){return function(n,t){return void 0===t&&(t=null),null==n?[t,null,o.NowaitState.fulfilled]:n instanceof Promise?function(t,e,r,n){return void 0===n&&(n=null),e.has(r)||(e.set(r,[n,null,o.NowaitState.pending]),r.then(function(n){e.set(r,[n,null,o.NowaitState.fulfilled]),t()}).catch(function(n){e.set(r,[null,n,o.NowaitState.rejected]),t()})),e.get(r)}(e,r,n,t):function(n){return n.subscribe&&W==typeof n.subscribe}(n)?function(t,e,n,r,u,i){return void 0===i&&(i=null),e.has(u)||e.set(u,[i,null,o.NowaitState.pending]),n.has(u)||n.set(u,u.subscribe(function(n){r.add(u),e.set(u,[n,null,o.NowaitState.acquired]),t()},function(n){r.add(u),e.set(u,[null,n,o.NowaitState.rejected]),t()},function(){var n=e.has(u)?e.get(u)[0]:null;r.add(u),e.set(u,[n,null,o.NowaitState.fulfilled]),t()})),r.has(u)&&r.delete(u),e.get(u)}(e,r,u,i,n,t):n instanceof Error?[null,n,o.NowaitState.rejected]:[n,null,o.NowaitState.fulfilled]}}function J(n,t,e,r){return L(n,b,t||D(n,b)||{}),L(n,w,e||D(n,w)||{}),L(n,N,r||""),n}(n=o.NowaitState||(o.NowaitState={}))[n.pending=0]="pending",n[n.fulfilled=1]="fulfilled",n[n.rejected=2]="rejected",n[n.acquired=3]="acquired";var l=function(){return(l=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var u in t=arguments[e])Object.prototype.hasOwnProperty.call(t,u)&&(n[u]=t[u]);return n}).apply(this,arguments)};var s={};function f(n,t,u,e,r,i){if(!i)return B(r,0,u);if(!r){L(i,P,i[j]);var o=function(n,t,e,r){var u=s[n],i=s[t],o=i&&(!u||u<i)&&t||n;if(R!=o)return o;var a=e[O];return r.get(a)||R==n&&!D(e,j+".on"+R)?q:R}(R!=e&&q!=e?R:T,e,i,n);return i[A]=o,i[E]=i[E].map(function(n){return u(o,null,n)}),i}L(i,P,i[j]),i[j]=r[j],i[c]=r[c],i[g]=r[g],i[A]=T;var a=i[E].map(function(n,t){return n.i=t,n}),f=r[E].map(function(n){var t,e,r;for(r=0;r<a.length;r++)if(e=a[r],n[g]==e[g]&&n[c]==e[c]&&(T===e[A]||M===e[A])){t=e;break}return t?(a.splice(r,1),u(T,n,t)):u(T,n)});return a.map(function(n){if(0===(n=u(T,null,n)).i)f.unshift(n);else{var t=n.i-1,e=void 0;for(e=0;e<f.length;e++)if(t===f[e].i)return void f.splice(e+1,0,n);f.push(n)}}),i[E]=f,i}s[R]=1,s[q]=2;var v="http://www.w3.org/1999/xlink";function K(n,t,e,r,u,i){if("o"===t[0]&&"n"===t[1]){var o=t.slice(2);e instanceof Function?r instanceof Function||n.addEventListener(o,i):n.removeEventListener(o,i)}else{var a=null==e||!1===e;if(t in n&&"list"!==t&&"draggable"!==t&&"spellcheck"!==t&&"translate"!==t&&!u)a?n.removeAttribute(t):n[t]=null==e?"":e;else{var f=!1;if(u){var c=t;f=(t=t.replace(/^xlink:?/,""))!==c}switch((a?1:0)+((f?1:0)<<1)){case 0:n.setAttribute(t,e);break;case 1:n.removeAttribute(t);break;case 2:n.setAttributeNS(v,t,e);break;case 3:n.removeAttributeNS(v,t)}}}}function d(n,t,e,r,u,i,o,a,f,c){var l,s=C({},f),v=f[O];c||"svg"!==f[g]||(c=!0);var d,p=s[A],h=null;switch(p){case M:d=!0,v=function(n,t,e,r){var u=n[j]||{};if(n[g]===I)return document.createTextNode(D(u,y));var i=(t=t||"svg"===n[g])?document.createElementNS("http://www.w3.org/2000/svg",n[g]):document.createElement(n[g]);for(var o in u)F!=typeof u[o]&&K(i,o,u[o],null,t,e);return r.set(i,u),i}(f,c,r,u);break;case T:l=function(n,t,e,r){var u=n[O],i=n[j],o=D(n,P)||{},a=!1;if(n[g]===I)return(a=D(i,y)!=D(o,y))&&(u.nodeValue=D(i,y)),[u,a];for(var f in i)F!=typeof i[f]&&i[f]!==("value"===f||"checked"===f?u[f]:o[f])&&(K(u,f,i[f],o[f],t,e),a=!0);return r.set(u,i),[u,a]}(f,c,r,u),v=l[0],d=l[1];break;case q:d=!0,t.push(function(){var n=v.parentElement||v.parentNode;n&&n.removeChild(v)});break;case R:i.has(v)||(i.set(v,!1),d=!0,h={done:function(){i.set(v,!0),Promise.resolve({}).then(n)}})}d&&e.push(function(t,n,e){void 0===e&&(e={});var r=[new CustomEvent("lifecycle",{detail:C({type:n},e)}),new CustomEvent(n,{detail:e})];return function(){return r.map(function(n){return t.dispatchEvent(n)})}}(v,p,h));var m=f[E].reduce(function(n,t){var e=a(t,c);return e?n.concat(e):n},[]);return p===q?null:(m.map(function(n){return n[O]}).reduceRight(function(n,t){return t.parentNode===v&&t.nextSibling===n||v.insertBefore(t,n),t},null),s[E]=m,s[O]=v,s)}var e=[t,W];function Q(n){return null!=n&&F===typeof n&&j in n&&E in n&&c in n&&g in n&&F===typeof n[j]&&F===typeof n[E]&&"length"in n[E]&&(null==n[c]||t===typeof n[c])&&0<=e.indexOf(typeof n[g])}function U(n,t){for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];for(var u=[];e.length;){var i=e.pop();i&&Array.isArray(i)?e=e.concat(i):null!=i&&!0!==i&&!1!==i&&u.unshift(Q(i)&&i||V(!0,i))}return V(!1,n,t||{},u)}function X(n,e,t,r){return t.reduce(function(n,t){return n.push.apply(n,e(t,r)),n},[])}function p(r,u){return function(n,e){return function(n,t){return function(n,t,e,r,u,i){if(!u)return[];if(U===u.name)return X(0,r,u[E],i);var o=u[j],a=i&&i[j]||{},f=D(o,N);if(!f){var c=D(a,N)||"",l=D(o,S);null!=l&&(l=""+l),f=c&&l?c+"."+l:l||c}var s=n(f,!1);s||t(s={},f);var v=D(o,x);if(v)for(var d in v)!v.hasOwnProperty(d)||d in s||(s[d]=v[d]);var p,h=s,m=C(C({},D(o,w)||{}),i&&D(i,j+"."+w)||{}),y=J(o,h,m,f);if(typeof u.name===W){var g=u.name(y,u[E],h,m);p=Q(g)?r(g,u):[]}else p=[u];return p.reduce(function(n,t){return Q(t)&&(t[E]=X(0,r,t[E],t),n.push(t)),n},[])}(r,u,0,e,n,t)}}}function Y(e,r,u){var i=new WeakMap,o=new WeakMap,a=function(a,f,c){return function(n){var t=n.currentTarget,e=c.get(t)||{},r=D(e,N)||"",u=n.detail||{},i=D(e,w)||{},o=e["on"+n.type](f(r),l({},i,u),e,n);a(o,r)}}(e,r,i);return function(){var n=[],t=[];return[p(r,u),function(u){return function(n,r){return function(n,t,e){return f(u,0,r,n,t,e)}}}(o),function(r,u,i,o,a,f){return function(n,e){return function(n,t){return d(r,u,i,o,a,f,0,e,n,t)}}}(e,n,t,a,i,o),function(){return function(){t.reduceRight(function(n,t){return t()},0),n.reduceRight(function(n,t){return t()},0)}}]}}function Z(n,t){var e=n[0],r=n[1];return[t?t(e,r):e,r]}function r(n){return U(U,{},n.children)}function u(n){return U(U,{},n.children)}o.atto=function(t,n,e){void 0===e&&(e={});var r=!1,u=!1,i=!1,o=n instanceof Element?function(n){var t=B(V(!1,n.nodeName),0,z);return t[O]=n,t}(n):n,a=D(J(o[j]),b),f=k in e&&e[k]||[],c=function(e,r,u){return function(n,t){return void 0===t&&(t=""),G(e,r,u,n,t)}}(h,m,x),l=function(n){var t=new WeakMap,e=new Map,r=new Set;return[H(n,t,e,r),function(e,n){return function(){n.forEach(function(n){if(e.has(n)){var t=e.get(n);e.delete(n),t.unsubscribe()}}),n.clear()}}(e,r)]}(x),s=l[0],v=l[1],d={mutate:c,nowait:s},p=[Y].concat(f).map(function(n){return n(c,h,m,t,o)});function h(n,t){return void 0===t&&(t={}),(n?D(a,n):a)||t}function m(n,t){t?L(a,t,n):a=n}function y(){try{u=!0,o=function(n,t,e,r){var u=r.map(function(n){return n[0]}).reduce(Z,[function(){return[]},function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return u.apply(null,n)}])[0],i=r.map(function(n){return n[1]}).reduce(Z,[z,function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return i.apply(null,n)}])[0],o=r.map(function(n){return n[2]}).reduce(Z,[z,function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return o.apply(null,n)}])[0],a=r.map(function(n){return n[3]}).reduce(Z,[z,z])[0],f=u(U(t,{xa:{extra:e}},[])),c=C({},n);c[E]=f;var l=i(T,c,n);return n=o(l,"svg"===l.name),a(),n}(o,t,d,p.map(function(n){return n()}))}finally{u=r=!1}}function g(){i?(i=!1,x()):v()}function w(n){throw g(),n}function x(){r?u&&(i=!0):(r=!0,Promise.resolve().then(y).then(g,w))}return c},o.Context=function(n,t){return U(r,{xa:{slice:n.slice,fill:n.fill},children:t})},o.currentOnly=function(u){return function(n,t,e,r){if(r.currentTarget===r.target)return u(n,t,e,r)}},o.Extra=function(n,t){return U(u,{xa:{extra:n},children:t})},o.x=U});
//# sourceMappingURL=xatto.min.js.map
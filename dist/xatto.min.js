!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.xatto={})}(this,function(o){"use strict";var b="xa.context",d="xa.extra",p="xa.fill",h="xa.path",m="xa.slice",w="xa.text",N="middlewares",S="children",f="key",g="name",k="props",E="node",x="lifecycle",y="prev."+k;function j(n,t){for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}var A="create",P="destroy",C="remove",M="update";function O(n,t,e,r){for(void 0===r&&(r=".");;){if("object"!=typeof n)return!1;var u=t.indexOf(r);if(u<0)return n[t]=e,!0;var i=t.slice(0,u),o=t.slice(u+1);if(null==n[i]){var a=o.split(r,1)[0];n[i]=a===""+parseInt(a,10)?[]:{}}n=n[i],t=o}}function q(n,t,e){var r=j({},n);return r.i=0,r[x]=A,r[S]=n[S].map(function(n){return e(A,n)}),O(r,y,{}),r}var n,R="xa-txt";function T(n,t,e,r){void 0===e&&(e={}),void 0===r&&(r=[]);var u={};return u[g]=t,u[k]=e,u[S]=r,u[f]=e.key,n&&"function"!=typeof t&&(u[g]=R,O(u[k],w,t)),u}function W(){}function F(n,t,e){for(void 0===e&&(e=".");;){if(null==n)return n;var r=t.indexOf(e);if(r<0)return n[t];n=n[t.slice(0,r)],t=t.slice(r+1)}}function L(t,e,r,n,u){if(n){if(n instanceof Promise)return n.then(function(n){return L(t,e,r,n,u)});if("function"==typeof n)return n(L,t);if("object"==typeof n){var i=t(u);if(n===i)return;var o=j(j({},i),n);e(o,u),r()}}}function B(e,r,u,i){return function(n,t){return void 0===t&&(t=null),null==n?[t,null,o.NowaitState.fulfilled]:n instanceof Promise?function(t,e,r,n){return void 0===n&&(n=null),e.has(r)||(e.set(r,[n,null,o.NowaitState.pending]),r.then(function(n){e.set(r,[n,null,o.NowaitState.fulfilled]),t()}).catch(function(n){e.set(r,[null,n,o.NowaitState.rejected]),t()})),e.get(r)}(e,r,n,t):function(n){return n.subscribe&&"function"==typeof n.subscribe}(n)?function(t,e,n,r,u,i){return void 0===i&&(i=null),e.has(u)||e.set(u,[i,null,o.NowaitState.pending]),n.has(u)||n.set(u,u.subscribe(function(n){r.add(u),e.set(u,[n,null,o.NowaitState.acquired]),t()},function(n){r.add(u),e.set(u,[null,n,o.NowaitState.rejected]),t()},function(){var n=e.has(u)?e.get(u)[0]:null;r.add(u),e.set(u,[n,null,o.NowaitState.fulfilled]),t()})),r.has(u)&&r.delete(u),e.get(u)}(e,r,u,i,n,t):n instanceof Error?[null,n,o.NowaitState.rejected]:[n,null,o.NowaitState.fulfilled]}}function I(n,t,e,r){return O(n,b,t||F(n,b)||{}),O(n,d,e||F(n,d)||{}),O(n,h,r||""),n}(n=o.NowaitState||(o.NowaitState={}))[n.pending=0]="pending",n[n.fulfilled=1]="fulfilled",n[n.rejected=2]="rejected",n[n.acquired=3]="acquired";var l={};function c(n,t,u,e,r,i){if(!i)return q(r,0,u);if(!r){O(i,y,i[k]);var o=function(n,t,e,r){var u=l[n],i=l[t],o=i&&(!u||u<i)&&t||n;if(C!=o)return o;var a=e[E];return r.get(a)||C==n&&!F(e,k+".on"+C)?P:C}(C!=e&&P!=e?C:M,e,i,n);return i[x]=o,i[S]=i[S].map(function(n){return u(o,null,n)}),i}O(i,y,i[k]),i[k]=r[k],i[f]=r[f],i[g]=r[g],i[x]=M;var a=i[S].map(function(n,t){return n.i=t,n}),c=r[S].map(function(n){var t,e,r;for(r=0;r<a.length;r++)if(e=a[r],n[g]==e[g]&&n[f]==e[f]&&(M===e[x]||A===e[x])){t=e;break}return t?(a.splice(r,1),u(M,n,t)):u(M,n)});return a.map(function(n){if(0===(n=u(M,null,n)).i)c.unshift(n);else{var t=n.i-1,e=void 0;for(e=0;e<c.length;e++)if(t===c[e].i)return void c.splice(e+1,0,n);c.push(n)}}),i[S]=c,i}l[C]=1,l[P]=2;var s="http://www.w3.org/1999/xlink";function V(n,t,e,r,u,i){if("o"===t[0]&&"n"===t[1]){var o=t.slice(2);e instanceof Function?r instanceof Function||n.addEventListener(o,i):n.removeEventListener(o,i)}else{var a=null==e||!1===e;if(t in n&&"list"!==t&&"draggable"!==t&&"spellcheck"!==t&&"translate"!==t&&!u)a?n.removeAttribute(t):n[t]=null==e?"":e;else{var c=!1;if(u){var f=t;c=(t=t.replace(/^xlink:?/,""))!==f}switch((a?1:0)+((c?1:0)<<1)){case 0:n.setAttribute(t,e);break;case 1:n.removeAttribute(t);break;case 2:n.setAttributeNS(s,t,e);break;case 3:n.removeAttributeNS(s,t)}}}}function v(n,t,e,r,u,i,o,a,c,f){var l,s=j({},c),v=c[E];f||"svg"!==c[g]||(f=!0);var d,p=s[x],h=null;switch(p){case A:d=!0,v=function(n,t,e,r){var u=n[k]||{};if(n[g]===R)return document.createTextNode(F(u,w));var i=(t=t||"svg"===n[g])?document.createElementNS("http://www.w3.org/2000/svg",n[g]):document.createElement(n[g]);for(var o in u)"object"!=typeof u[o]&&V(i,o,u[o],null,t,e);return r.set(i,u),i}(c,f,r,u);break;case M:l=function(n,t,e,r){var u=n[E],i=n[k],o=F(n,y)||{},a=!1;if(n[g]===R)return(a=F(i,w)!=F(o,w))&&(u.nodeValue=F(i,w)),[u,a];for(var c in i)"object"!=typeof i[c]&&i[c]!==("value"===c||"checked"===c?u[c]:o[c])&&(V(u,c,i[c],o[c],t,e),a=!0);return r.set(u,i),[u,a]}(c,f,r,u),v=l[0],d=l[1];break;case P:d=!0,t.push(function(){var n=v.parentElement||v.parentNode;n&&n.removeChild(v)});break;case C:i.has(v)||(i.set(v,!1),d=!0,h={done:function(){i.set(v,!0),Promise.resolve({}).then(n)}})}d&&e.push(function(t,n,e){void 0===e&&(e={});var r=[new CustomEvent("lifecycle",{detail:j({type:n},e)}),new CustomEvent(n,{detail:e})];return function(){return r.map(function(n){return t.dispatchEvent(n)})}}(v,p,h));var m=c[S].reduce(function(n,t){var e=a(t,f);return e?n.concat(e):n},[]);return p===P?null:(m.map(function(n){return n[E]}).reduceRight(function(n,t){return t.parentNode===v&&t.nextSibling===n||v.insertBefore(t,n),t},null),s[S]=m,s[E]=v,s)}function z(n){return null!=n&&"object"==typeof n&&k in n&&S in n&&f in n&&g in n}function D(n,t){for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];for(var u=[];e.length;){var i=e.pop();i&&Array.isArray(i)?e=e.concat(i):null!=i&&!0!==i&&!1!==i&&u.unshift(z(i)&&i||T(!0,i))}return T(!1,n,t||{},u)}function G(n,e,t,r){return t.reduce(function(n,t){return n.push.apply(n,e(t,r)),n},[])}function H(r,u){return function(n,e){return function(n,t){return function(n,t,e,r,u,i){if(!u)return[];if(D===u.name)return G(0,r,u[S],i);var o=u[k],a=i&&i[k]||{},c=F(o,h);if(!c){var f=F(a,h)||"",l=F(o,m);null!=l&&(l=""+l),c=f&&l?f+"."+l:l||f}var s=n(c);s||t(s=j({},F(o,p)||{}),c);var v=I(o,s,j(j({},F(o,d)||{}),i&&F(i,k+"."+d)||{}),c);return("function"==typeof u.name?r(u.name(v,u[S]),u):[u]).reduce(function(n,t){return z(t)&&(t[S]=G(0,r,t[S],t),n.push(t)),n},[])}(r,u,0,e,n,t)}}}function J(e,r,u){var i=new WeakMap,o=new WeakMap,a=function(o,a,c){return function(n){var t=n.currentTarget,e=c.get(t)||{},r=F(e,h)||"",u=n.detail||{},i=e["on"+n.type](a(r),u,e,n);o(i,r)}}(e,r,i);return function(){var n=[],t=[];return[H(r,u),function(u){return function(n,r){return function(n,t,e){return c(u,0,r,n,t,e)}}}(o),function(r,u,i,o,a,c){return function(n,e){return function(n,t){return v(r,u,i,o,a,c,0,e,n,t)}}}(e,n,t,a,i,o),function(){return function(){t.reduceRight(function(n,t){return t()},0),n.reduceRight(function(n,t){return t()},0)}}]}}function K(n,t){var e=n[0],r=n[1];return[t?t(e,r):e,r]}function e(n){return D(D,{},n.children)}function r(n){return D(D,{},n.children)}o.atto=function(t,n,e){void 0===e&&(e={});var r=!1,u=!1,i=!1,o=n instanceof Element?function(n){var t=q(T(!1,n.nodeName),0,W);return t[E]=n,t}(n):n,a=F(I(o[k]),b),c=N in e&&e[N]||[],f=function(e,r,u){return function(n,t){return void 0===t&&(t=""),L(e,r,u,n,t)}}(h,m,y),l=function(n){var t=new WeakMap,e=new Map,r=new Set;return[B(n,t,e,r),function(e,n){return function(){n.forEach(function(n){if(e.has(n)){var t=e.get(n);e.delete(n),t.unsubscribe()}}),n.clear()}}(e,r)]}(y),s=l[0],v=l[1],d={mutate:f,nowait:s},p=[J].concat(c).map(function(n){return n(f,h,m,t,o)});function h(n,t){return void 0===t&&(t={}),(n?F(a,n):a)||t}function m(n,t){t?O(a,t,n):a=n}function w(){try{u=!0,o=function(n,t,e,r){var u=r.map(function(n){return n[0]}).reduce(K,[W,function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return u.apply(null,n)}])[0],i=r.map(function(n){return n[1]}).reduce(K,[W,function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return i.apply(null,n)}])[0],o=r.map(function(n){return n[2]}).reduce(K,[W,function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return o.apply(null,n)}])[0],a=r.map(function(n){return n[3]}).reduce(K,[W,W])[0],c=u(D(t,{xa:{extra:e}},[])),f=j({},n);f[S]=c;var l=i(M,f,n);return n=o(l,"svg"===l.name),a(),n}(o,t,d,p.map(function(n){return n()}))}finally{u=!1}}function g(){r=!1,i?(i=!1,y()):v()}function x(n){throw g(),n}function y(){r?u&&(i=!0):(r=!0,Promise.resolve().then(w).then(g,x))}return f},o.Context=function(n,t){return D(e,{xa:{slice:n.slice,fill:n.fill},children:t})},o.currentOnly=function(u){return function(n,t,e,r){if(r.currentTarget===r.target)return u(n,t,e,r)}},o.Extra=function(n,t){return D(r,{xa:{extra:n},children:t})},o.x=D});
//# sourceMappingURL=xatto.min.js.map
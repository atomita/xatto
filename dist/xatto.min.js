!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(n.xatto={})}(this,function(o){"use strict";var x="xa.context",y="xa.extra",b="xa.fill",N="xa.path",S="xa.slice",w="xa.text",k="middlewares",E="children",f="key",g="name",j="props",O="node",A="lifecycle",P="prev."+j;function C(n,e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}var M="create",q="destroy",T="remove",W="update",F="function",L="object",e="string";function R(n,e,t,r){for(void 0===r&&(r=".");;){if(L!==typeof n)return!1;var u=e.indexOf(r);if(u<0)return n[e]=t,!0;var i=e.slice(0,u),o=e.slice(u+1);if(null==n[i]){var a=o.split(r,1)[0];n[i]=a===""+parseInt(a,10)?[]:{}}n=n[i],e=o}}function B(n,e,t){var r=C({},n);return r.i=0,r[A]=M,r[E]=n[E].map(function(n){return t(M,n)}),R(r,P,{}),r}var n,I="xa-txt";function V(n,e,t,r){void 0===t&&(t={}),void 0===r&&(r=[]);var u={};return u[g]=e,u[j]=t,u[E]=r,u[f]=t.key,n&&F!==typeof e&&(u[g]=I,R(u[j],w,e)),u}function z(){}function D(n,e,t){for(void 0===t&&(t=".");;){if(null==n)return n;var r=e.indexOf(t);if(r<0)return n[e];n=n[e.slice(0,r)],e=e.slice(r+1)}}function G(e,t,r,n,u){if(n){if(n instanceof Promise)return n.then(function(n){return G(e,t,r,n,u)});if(F===typeof n)return n(G,e);if(L===typeof n){var i=e(u);if(n===i)return;var o=C(C({},i),n);t(o,u),r()}}}function H(t,r,u,i){return function(n,e){return void 0===e&&(e=null),null==n?[e,null,o.NowaitState.fulfilled]:n instanceof Promise?function(e,t,r,n){return void 0===n&&(n=null),t.has(r)||(t.set(r,[n,null,o.NowaitState.pending]),r.then(function(n){t.set(r,[n,null,o.NowaitState.fulfilled]),e()}).catch(function(n){t.set(r,[null,n,o.NowaitState.rejected]),e()})),t.get(r)}(t,r,n,e):function(n){return n.subscribe&&F==typeof n.subscribe}(n)?function(e,t,n,r,u,i){return void 0===i&&(i=null),t.has(u)||t.set(u,[i,null,o.NowaitState.pending]),n.has(u)||n.set(u,u.subscribe(function(n){r.add(u),t.set(u,[n,null,o.NowaitState.acquired]),e()},function(n){r.add(u),t.set(u,[null,n,o.NowaitState.rejected]),e()},function(){var n=t.has(u)?t.get(u)[0]:null;r.add(u),t.set(u,[n,null,o.NowaitState.fulfilled]),e()})),r.has(u)&&r.delete(u),t.get(u)}(t,r,u,i,n,e):n instanceof Error?[null,n,o.NowaitState.rejected]:[n,null,o.NowaitState.fulfilled]}}function J(n,e,t,r){return R(n,x,e||D(n,x)||{}),R(n,y,t||D(n,y)||{}),R(n,N,r||""),n}(n=o.NowaitState||(o.NowaitState={}))[n.pending=0]="pending",n[n.fulfilled=1]="fulfilled",n[n.rejected=2]="rejected",n[n.acquired=3]="acquired";var l=function(){return(l=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var u in e=arguments[t])Object.prototype.hasOwnProperty.call(e,u)&&(n[u]=e[u]);return n}).apply(this,arguments)};var s={};function a(n,e,u,t,r,i){if(!i)return B(r,0,u);if(!r){R(i,P,i[j]);var o=function(n,e,t,r){var u=s[n],i=s[e],o=i&&(!u||u<i)&&e||n;if(T!=o)return o;var a=t[O];return r.get(a)||T==n&&!D(t,j+".on"+T)?q:T}(T!=t&&q!=t?T:W,t,i,n);return i[A]=o,i[E]=i[E].map(function(n){return u(o,null,n)}),i}R(i,P,i[j]),i[j]=r[j],i[f]=r[f],i[g]=r[g],i[A]=W;var a=i[E].map(function(n,e){return n.i=e,n}),c=r[E].map(function(n){var e,t,r;for(r=0;r<a.length;r++)if(t=a[r],n[g]==t[g]&&n[f]==t[f]&&(W===t[A]||M===t[A])){e=t;break}return e?(a.splice(r,1),u(W,n,e)):u(W,n)});return a.map(function(n){if(0===(n=u(W,null,n)).i)c.unshift(n);else{var e=n.i-1,t=void 0;for(t=0;t<c.length;t++)if(e===c[t].i)return void c.splice(t+1,0,n);c.push(n)}}),i[E]=c,i}s[T]=1,s[q]=2;var v="http://www.w3.org/1999/xlink";function K(n,e,t,r,u,i){if("o"===e[0]&&"n"===e[1]){var o=e.slice(2);t instanceof Function?r instanceof Function||n.addEventListener(o,i):n.removeEventListener(o,i)}else{var a=null==t||!1===t;if(e in n&&"list"!==e&&"draggable"!==e&&"spellcheck"!==e&&"translate"!==e&&!u)a?n.removeAttribute(e):n[e]=null==t?"":t;else{var c=!1;if(u){var f=e;c=(e=e.replace(/^xlink:?/,""))!==f}switch((a?1:0)+((c?1:0)<<1)){case 0:n.setAttribute(e,t);break;case 1:n.removeAttribute(e);break;case 2:n.setAttributeNS(v,e,t);break;case 3:n.removeAttributeNS(v,e)}}}}function Q(e,n,t){void 0===t&&(t={});var r=[new CustomEvent("lifecycle",{detail:C({type:n},t)}),new CustomEvent(n,{detail:t})];return function(){return r.map(function(n){return e.dispatchEvent(n)})}}function c(n,e,t,r,u,i,o,a,c){var f,l=C({},a),s=a[O];c||"svg"!==a[g]||(c=!0);var v,d=l[A],p=null;switch(d){case M:v=!0,s=function(n,e,t,r){var u=n[j]||{};if(n[g]===I)return document.createTextNode(D(u,w));var i=(e=e||"svg"===n[g])?document.createElementNS("http://www.w3.org/2000/svg",n[g]):document.createElement(n[g]);for(var o in u)L!=typeof u[o]&&K(i,o,u[o],null,e,t);return r.set(i,u),i}(a,c,t,r);break;case W:f=function(n,e,t,r){var u=n[O],i=n[j],o=D(n,P)||{},a=!1;if(n[g]===I)return(a=D(i,w)!=D(o,w))&&(u.nodeValue=D(i,w)),[u,a];for(var c in C(C({},i),o))L!=typeof i[c]&&i[c]!==("value"===c||"checked"===c?u[c]:o[c])&&(K(u,c,i[c],o[c],e,t),a=!0);return r.set(u,i),[u,a]}(a,c,t,r),s=f[0],v=f[1];break;case q:Q(s,d,p)();var h=s.parentElement||s.parentNode;h&&h.removeChild(s);break;case T:u.has(s)||(u.set(s,!1),v=!0,p={done:function(){u.set(s,!0),Promise.resolve({}).then(n)}})}v&&e.push(Q(s,d,p));var m=a[E].reduce(function(n,e){var t=o(e,c);return t?n.concat(t):n},[]);return d===q?null:(m.map(function(n){return n[O]}).reduceRight(function(n,e){return e.parentNode===s&&e.nextSibling===n||s.insertBefore(e,n),e},null),l[E]=m,l[O]=s,l)}var t=[e,F];function U(n){return null!=n&&L===typeof n&&j in n&&E in n&&f in n&&g in n&&L===typeof n[j]&&L===typeof n[E]&&"length"in n[E]&&(null==n[f]||e===typeof n[f])&&0<=t.indexOf(typeof n[g])}function X(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];for(var u=[];t.length;){var i=t.pop();i&&Array.isArray(i)?t=t.concat(i):null!=i&&!0!==i&&!1!==i&&u.unshift(U(i)&&i||V(!0,i))}return V(!1,n,e||{},u)}function Y(n,t,e,r){return e.reduce(function(n,e){return n.push.apply(n,t(e,r)),n},[])}function d(r,u){return function(n,t){return function(n,e){return function(n,e,t,r,u,i){if(!u)return[];if(X===u.name)return Y(0,r,u[E],i);var o=u[j],a=i&&i[j]||{},c=D(o,N);if(!c){var f=D(a,N)||"",l=D(o,S);null!=l&&(l=""+l),c=f&&l?f+"."+l:l||f}var s=n(c,!1);s||e(s={},c);var v=D(o,b);if(v)for(var d in v)!v.hasOwnProperty(d)||d in s||(s[d]=v[d]);var p,h=s,m=C(C({},D(o,y)||{}),i&&D(i,j+"."+y)||{}),w=J(o,h,m,c);if(typeof u.name===F){var g=u.name(w,u[E],h,m);p=U(g)?r(g,u):[]}else p=[u];return p.reduce(function(n,e){return U(e)&&(e[E]=Y(0,r,e[E],e),n.push(e)),n},[])}(r,u,0,t,n,e)}}}function Z(e,t,r){var u=new WeakMap,i=new WeakMap,o=function(a,c,f){return function(n){var t=n.currentTarget,e=f.get(t)||{},r=D(e,N)||"",u=n.detail||{},i=D(e,y)||{},o=e["on"+n.type](c(r),l({},i,u,{dispatch:function(n,e){void 0===e&&(e={}),t&&t.dispatchEvent(new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:e}))}}),e,n);a(o,r)}}(e,t,u);return function(){var n=[];return[d(t,r),function(u){return function(n,r){return function(n,e,t){return a(u,0,r,n,e,t)}}}(i),function(r,u,i,o,a){return function(n,t){return function(n,e){return c(r,u,i,o,a,0,t,n,e)}}}(e,n,o,u,i),function(){return function(){n.reduceRight(function(n,e){return e()},0)}}]}}function $(n,e){var t=n[0],r=n[1];return[e?e(t,r):t,r]}function r(n){return X(X,{},n.children)}function u(n){return X(X,{},n.children)}o.atto=function(e,n,t){void 0===t&&(t={});var r=!1,u=!1,i=!1,o=n instanceof Element?function(n){var e=B(V(!1,n.nodeName),0,z);return e[O]=n,e}(n):n,a=D(J(o[j]),x),c=k in t&&t[k]||[],f=function(t,r,u){return function(n,e){return void 0===e&&(e=""),G(t,r,u,n,e)}}(h,m,b),l=function(n){var e=new WeakMap,t=new Map,r=new Set;return[H(n,e,t,r),function(t,n){return function(){n.forEach(function(n){if(t.has(n)){var e=t.get(n);t.delete(n),e.unsubscribe()}}),n.clear()}}(t,r)]}(b),s=l[0],v=l[1],d={mutate:f,nowait:s},p=[Z].concat(c).map(function(n){return n(f,h,m,e,o)});function h(n,e){return void 0===e&&(e={}),(n?D(a,n):a)||e}function m(n,e){e?R(a,e,n):a=n}function w(){u=!0,o=function(n,e,t,r){var u=r.map(function(n){return n[0]}).reduce($,[function(){return[]},function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return u.apply(null,n)}])[0],i=r.map(function(n){return n[1]}).reduce($,[z,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return i.apply(null,n)}])[0],o=r.map(function(n){return n[2]}).reduce($,[z,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return o.apply(null,n)}])[0],a=r.map(function(n){return n[3]}).reduce($,[z,z])[0],c=u(X(e,{xa:{extra:t}},[])),f=C({},n);f[E]=c;var l=i(W,f,n);return n=o(l,"svg"===l.name),a(),n}(o,e,d,p.map(function(n){return n()}))}function g(){u=r=!1,i?(i=!1,b()):v()}function y(n){throw g(),n}function b(){r?u&&(i=!0):(r=!0,Promise.resolve().then(w).then(g,y))}return f},o.Context=function(n,e){return X(r,{xa:{slice:n.slice,fill:n.fill},children:e})},o.currentOnly=function(u){return function(n,e,t,r){if(r.currentTarget===r.target)return u(n,e,t,r)}},o.Extra=function(n,e){return X(u,{xa:{extra:n},children:e})},o.x=X});
//# sourceMappingURL=xatto.min.js.map
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.xatto={})}(this,function(o){"use strict";var b="xa.context",m="xa.extra",w="xa.fill",g="xa.path",y="xa.slice",x="xa.text",N="middlewares",S="children",f="key",k="name",E="props",j="node",A="lifecycle",P="prev."+E;function O(n,t){for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}var C="create",M="destroy",q="remove",R="update";function T(n,t,e,r){for(void 0===r&&(r=".");;){if("object"!=typeof n)return!1;var u=t.indexOf(r);if(u<0)return n[t]=e,!0;var i=t.slice(0,u),o=t.slice(u+1);if(null==n[i]){var a=o.split(r,1)[0];n[i]=a===""+parseInt(a,10)?[]:{}}n=n[i],t=o}}function W(n,t,e){var r=O({},n);return r.i=0,r[A]=C,r[S]=n[S].map(function(n){return e(C,n)}),T(r,P,{}),r}var n,F="xa-txt";function L(n,t,e,r){void 0===e&&(e={}),void 0===r&&(r=[]);var u={};return u[k]=t,u[E]=e,u[S]=r,u[f]=e.key,n&&"function"!=typeof t&&(u[k]=F,T(u[E],x,t)),u}function B(){}function I(n,t,e){for(void 0===e&&(e=".");;){if(null==n)return n;var r=t.indexOf(e);if(r<0)return n[t];n=n[t.slice(0,r)],t=t.slice(r+1)}}function V(t,e,r,n,u){if(n){if(n instanceof Promise)return n.then(function(n){return V(t,e,r,n,u)});if("function"==typeof n)return n(V,t);if("object"==typeof n){var i=t(u);if(n===i)return;var o=O(O({},i),n);e(o,u),r()}}}function z(e,r,u,i){return function(n,t){return void 0===t&&(t=null),null==n?[t,null,o.NowaitState.fulfilled]:n instanceof Promise?function(t,e,r,n){return void 0===n&&(n=null),e.has(r)||(e.set(r,[n,null,o.NowaitState.pending]),r.then(function(n){e.set(r,[n,null,o.NowaitState.fulfilled]),t()}).catch(function(n){e.set(r,[null,n,o.NowaitState.rejected]),t()})),e.get(r)}(e,r,n,t):function(n){return n.subscribe&&"function"==typeof n.subscribe}(n)?function(t,e,n,r,u,i){return void 0===i&&(i=null),e.has(u)||e.set(u,[i,null,o.NowaitState.pending]),n.has(u)||n.set(u,u.subscribe(function(n){r.add(u),e.set(u,[n,null,o.NowaitState.acquired]),t()},function(n){r.add(u),e.set(u,[null,n,o.NowaitState.rejected]),t()},function(){var n=e.has(u)?e.get(u)[0]:null;r.add(u),e.set(u,[n,null,o.NowaitState.fulfilled]),t()})),r.has(u)&&r.delete(u),e.get(u)}(e,r,u,i,n,t):n instanceof Error?[null,n,o.NowaitState.rejected]:[n,null,o.NowaitState.fulfilled]}}function D(n,t,e,r){return T(n,b,t||I(n,b)||{}),T(n,m,e||I(n,m)||{}),T(n,g,r||""),n}(n=o.NowaitState||(o.NowaitState={}))[n.pending=0]="pending",n[n.fulfilled=1]="fulfilled",n[n.rejected=2]="rejected",n[n.acquired=3]="acquired";var l={};function c(n,t,u,e,r,i){if(!i)return W(r,0,u);if(!r){T(i,P,i[E]);var o=function(n,t,e,r){var u=l[n],i=l[t],o=i&&(!u||u<i)&&t||n;if(q!=o)return o;var a=e[j];return r.get(a)||q==n&&!I(e,E+".on"+q)?M:q}(q!=e&&M!=e?q:R,e,i,n);return i[A]=o,i[S]=i[S].map(function(n){return u(o,null,n)}),i}T(i,P,i[E]),i[E]=r[E],i[f]=r[f],i[k]=r[k],i[A]=R;var a=i[S].map(function(n,t){return n.i=t,n}),c=r[S].map(function(n){var t,e,r;for(r=0;r<a.length;r++)if(e=a[r],n[k]==e[k]&&n[f]==e[f]&&(R===e[A]||C===e[A])){t=e;break}return t?(a.splice(r,1),u(R,n,t)):u(R,n)});return a.map(function(n){if(0===(n=u(R,null,n)).i)c.unshift(n);else{var t=n.i-1,e=void 0;for(e=0;e<c.length;e++)if(t===c[e].i)return void c.splice(e+1,0,n);c.push(n)}}),i[S]=c,i}l[q]=1,l[M]=2;var s="http://www.w3.org/1999/xlink";function G(n,t,e,r,u,i){if("o"===t[0]&&"n"===t[1]){var o=t.slice(2);e instanceof Function?r instanceof Function||n.addEventListener(o,i):n.removeEventListener(o,i)}else{var a=null==e||!1===e;if(t in n&&"list"!==t&&"draggable"!==t&&"spellcheck"!==t&&"translate"!==t&&!u)a?n.removeAttribute(t):n[t]=null==e?"":e;else{var c=!1;if(u){var f=t;c=(t=t.replace(/^xlink:?/,""))!==f}switch((a?1:0)+((c?1:0)<<1)){case 0:n.setAttribute(t,e);break;case 1:n.removeAttribute(t);break;case 2:n.setAttributeNS(s,t,e);break;case 3:n.removeAttributeNS(s,t)}}}}function v(n,t,e,r,u,i,o,a,c,f){var l,s=O({},c),v=c[j];f||"svg"!==c[k]||(f=!0);var d,p=s[A],h=null;switch(p){case C:d=!0,v=function(n,t,e,r){var u=n[E]||{};if(n[k]===F)return document.createTextNode(I(u,x));var i=(t=t||"svg"===n[k])?document.createElementNS("http://www.w3.org/2000/svg",n[k]):document.createElement(n[k]);for(var o in u)"object"!=typeof u[o]&&G(i,o,u[o],null,t,e);return r.set(i,u),i}(c,f,r,u);break;case R:l=function(n,t,e,r){var u=n[j],i=n[E],o=I(n,P)||{},a=!1;if(n[k]===F)return(a=I(i,x)!=I(o,x))&&(u.nodeValue=I(i,x)),[u,a];for(var c in i)"object"!=typeof i[c]&&i[c]!==("value"===c||"checked"===c?u[c]:o[c])&&(G(u,c,i[c],o[c],t,e),a=!0);return r.set(u,i),[u,a]}(c,f,r,u),v=l[0],d=l[1];break;case M:d=!0,t.push(function(){var n=v.parentElement||v.parentNode;n&&n.removeChild(v)});break;case q:i.has(v)||(i.set(v,!1),d=!0,h={done:function(){i.set(v,!0),Promise.resolve({}).then(n)}})}d&&e.push(function(t,n,e){void 0===e&&(e={});var r=[new CustomEvent("lifecycle",{detail:O({type:n},e)}),new CustomEvent(n,{detail:e})];return function(){return r.map(function(n){return t.dispatchEvent(n)})}}(v,p,h));var m=c[S].reduce(function(n,t){var e=a(t,f);return e?n.concat(e):n},[]);return p===M?null:(m.map(function(n){return n[j]}).reduceRight(function(n,t){return t.parentNode===v&&t.nextSibling===n||v.insertBefore(t,n),t},null),s[S]=m,s[j]=v,s)}function H(n){return null!=n&&"object"==typeof n&&E in n&&S in n&&f in n&&k in n}function J(n,t){for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];for(var u=[];e.length;){var i=e.pop();i&&Array.isArray(i)?e=e.concat(i):null!=i&&!0!==i&&!1!==i&&u.unshift(H(i)&&i||L(!0,i))}return L(!1,n,t||{},u)}function K(n,e,t,r){return t.reduce(function(n,t){return n.push.apply(n,e(t,r)),n},[])}function d(r,u){return function(n,e){return function(n,t){return function(n,t,e,r,u,i){if(!u)return[];if(J===u.name)return K(0,r,u[S],i);var o=u[E],a=i&&i[E]||{},c=I(o,g);if(!c){var f=I(a,g)||"",l=I(o,y);null!=l&&(l=""+l),c=f&&l?f+"."+l:l||f}var s=n(c),v=I(o,w);if(v){var d=!1;for(var p in v)!v.hasOwnProperty(p)||p in s||(s[p]=v[p],d=!0);d&&t(s,c)}var h=D(o,s,O(O({},I(o,m)||{}),i&&I(i,E+"."+m)||{}),c);return("function"==typeof u.name?r(u.name(h,u[S]),u):[u]).reduce(function(n,t){return H(t)&&(t[S]=K(0,r,t[S],t),n.push(t)),n},[])}(r,u,0,e,n,t)}}}function Q(e,r,u){var i=new WeakMap,o=new WeakMap,a=function(o,a,c){return function(n){var t=n.currentTarget,e=c.get(t)||{},r=I(e,g)||"",u=n.detail||{},i=e["on"+n.type](a(r),u,e,n);o(i,r)}}(e,r,i);return function(){var n=[],t=[];return[d(r,u),function(u){return function(n,r){return function(n,t,e){return c(u,0,r,n,t,e)}}}(o),function(r,u,i,o,a,c){return function(n,e){return function(n,t){return v(r,u,i,o,a,c,0,e,n,t)}}}(e,n,t,a,i,o),function(){return function(){t.reduceRight(function(n,t){return t()},0),n.reduceRight(function(n,t){return t()},0)}}]}}function U(n,t){var e=n[0],r=n[1];return[t?t(e,r):e,r]}function e(n){return J(J,{},n.children)}function r(n){return J(J,{},n.children)}o.atto=function(t,n,e){void 0===e&&(e={});var r=!1,u=!1,i=!1,o=n instanceof Element?function(n){var t=W(L(!1,n.nodeName),0,B);return t[j]=n,t}(n):n,a=I(D(o[E]),b),c=N in e&&e[N]||[],f=function(e,r,u){return function(n,t){return void 0===t&&(t=""),V(e,r,u,n,t)}}(h,m,x),l=function(n){var t=new WeakMap,e=new Map,r=new Set;return[z(n,t,e,r),function(e,n){return function(){n.forEach(function(n){if(e.has(n)){var t=e.get(n);e.delete(n),t.unsubscribe()}}),n.clear()}}(e,r)]}(x),s=l[0],v=l[1],d={mutate:f,nowait:s},p=[Q].concat(c).map(function(n){return n(f,h,m,t,o)});function h(n,t){return void 0===t&&(t={}),(n?I(a,n):a)||t}function m(n,t){t?T(a,t,n):a=n}function w(){try{u=!0,o=function(n,t,e,r){var u=r.map(function(n){return n[0]}).reduce(U,[B,function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return u.apply(null,n)}])[0],i=r.map(function(n){return n[1]}).reduce(U,[B,function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return i.apply(null,n)}])[0],o=r.map(function(n){return n[2]}).reduce(U,[B,function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return o.apply(null,n)}])[0],a=r.map(function(n){return n[3]}).reduce(U,[B,B])[0],c=u(J(t,{xa:{extra:e}},[])),f=O({},n);f[S]=c;var l=i(R,f,n);return n=o(l,"svg"===l.name),a(),n}(o,t,d,p.map(function(n){return n()}))}finally{u=!1}}function g(){r=!1,i?(i=!1,x()):v()}function y(n){throw g(),n}function x(){r?u&&(i=!0):(r=!0,Promise.resolve().then(w).then(g,y))}return f},o.Context=function(n,t){return J(e,{xa:{slice:n.slice,fill:n.fill},children:t})},o.currentOnly=function(u){return function(n,t,e,r){if(r.currentTarget===r.target)return u(n,t,e,r)}},o.Extra=function(n,t){return J(r,{xa:{extra:n},children:t})},o.x=J});
//# sourceMappingURL=xatto.min.js.map